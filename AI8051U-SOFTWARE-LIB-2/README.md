# AI8051U 软件库

> AI8051U 系列 32 位增强型 8051 单片机完整开发库

[![芯片](https://img.shields.io/badge/芯片-AI8051U-blue.svg)](http://www.stcai.com)
[![语言](https://img.shields.io/badge/语言-C51-green.svg)](https://www.keil.com)
[![版本](https://img.shields.io/badge/版本-V2.0-orange.svg)](./UPDATE-NOTE.txt)
[![更新](https://img.shields.io/badge/更新-2025--04--10-brightgreen.svg)](./UPDATE-NOTE.txt)

---

## 📖 简介

本项目是 STC（宏晶科技）官方提供的 **AI8051U 系列单片机软件开发库**，包含：

- ✅ **70+ 个驱动模块** - 覆盖所有片上外设
- ✅ **29 个独立示例** - 从入门到进阶的完整案例
- ✅ **综合应用框架** - 专业级分层架构设计
- ✅ **详细中文文档** - 包含完整使用说明
- ✅ **预编译库** - USB、数学运算加速库

---

## 🚀 快速开始

### 1. 克隆或下载本仓库

```bash
git clone <repository-url>
cd AI8051U-SOFTWARE-LIB-2
```

### 2. 安装开发工具

- **Keil C51** - [下载地址](https://www.keil.com)
- **STC-ISP** - [下载地址](http://www.stcai.com)
- **中断向量扩展插件** - 运行 `软件工具/拓展Keil的C代码中断号.exe`

### 3. 打开第一个示例

```
独立程序/01-IO-跑马灯/IO-LED.uvproj
```

按 `F7` 编译，使用 STC-ISP 下载到开发板即可看到效果！

### 4. 查看文档

- 📘 **[详细使用文档](./AI8051U-使用文档.md)** - 从入门到精通的完整教程
- 📙 **[快速参考指南](./AI8051U-快速参考.md)** - 常用代码片段和速查表
- 📕 **[官方手册](./AI8051U库函数使用说明-20250410.pdf)** - 库函数详细说明（PDF）

---

## 📁 项目结构

```
AI8051U-SOFTWARE-LIB-2/
│
├── 📂 库文件/                    # 核心驱动库（HAL 层）
│   ├── AI8051U.H                 # 芯片寄存器定义
│   ├── config.h                  # 系统配置文件
│   ├── AI8051U_GPIO.c/h          # GPIO 驱动
│   ├── AI8051U_UART.c/h          # 串口驱动
│   ├── AI8051U_Timer.c/h         # 定时器驱动
│   ├── AI8051U_ADC.c/h           # ADC 驱动
│   ├── AI8051U_PWM.c/h           # PWM 驱动
│   ├── AI8051U_SPI.c/h           # SPI 驱动
│   ├── AI8051U_I2C.c/h           # I2C 驱动
│   ├── AI8051U_DMA.c/h           # DMA 驱动
│   ├── AI8051U_QSPI.c/h          # QSPI 驱动
│   ├── AI8051U_EEPROM.c/h        # EEPROM 驱动
│   ├── AI8051U_RTC.c/h           # RTC 驱动
│   ├── AI8051U_WDT.c/h           # 看门狗驱动
│   ├── *_Isr.c                   # 各模块中断服务程序
│   └── *.LIB                     # 预编译库
│
├── 📂 独立程序/                   # 29 个独立示例工程
│   ├── 01-IO-跑马灯/             # ⭐ 从这里开始
│   ├── 02-Timer...               # 定时器示例
│   ├── 05-串口1...               # 串口通信示例
│   ├── 10-多路ADC...             # ADC 采样示例
│   ├── 15-I2C主机...             # I2C 通信示例
│   ├── 17-高级PWM...             # PWM 呼吸灯示例
│   ├── 20-串口发指令...          # SPI Flash 示例
│   ├── 21-ADC采样...             # DMA 应用示例
│   └── 29-硬件QSPI...            # QSPI Flash 示例
│
├── 📂 综合程序/                   # 完整应用框架
│   ├── Driver/                   # 驱动层
│   ├── App/                      # 应用层
│   │   ├── inc/                  # 应用头文件
│   │   └── src/                  # 应用实现
│   ├── User/                     # 用户层
│   │   ├── main.c                # 主程序
│   │   ├── Task.c/h              # 任务调度
│   │   └── System_init.c/h       # 系统初始化
│   └── RVMDK/                    # Keil 工程
│
├── 📂 软件工具/                   # 辅助工具
│   ├── 拓展Keil的C代码中断号.exe  # 中断向量扩展插件
│   └── Keil中断向量号拓展插件使用说明.pdf
│
├── 📄 AI8051U-使用文档.md         # ⭐ 详细使用教程
├── 📄 AI8051U-快速参考.md         # ⭐ 快速参考手册
├── 📄 AI8051U库函数使用说明.pdf   # 官方函数说明
├── 📄 UPDATE-NOTE.txt            # 更新记录
├── 📄 README.md                  # 本文件
└── 📄 keilclean.bat              # 清理脚本
```

---

## 🎯 示例工程导航

| 序号 | 工程名称 | 功能 | 难度 |
|:---:|---------|------|:----:|
| **基础 I/O** |
| 01 | IO-跑马灯 | GPIO 基础控制 | ⭐ |
| **定时器 & 中断** |
| 02 | Timer0~4 测试 | 定时器中断 | ⭐⭐ |
| 03 | 外中断 INT0~4 | 外部中断处理 | ⭐⭐ |
| 04 | 看门狗复位 | 看门狗功能 | ⭐⭐ |
| **串口通信** |
| 05 | 串口 1 中断收发 | UART 基础 | ⭐⭐ |
| 06~08 | 串口 2/3/4 | 多串口应用 | ⭐⭐ |
| 09 | 4 路串口同时 | 多串口并发 | ⭐⭐⭐ |
| **模拟功能** |
| 10 | 多路 ADC 转换 | ADC 采样 | ⭐⭐ |
| 11 | ADC + BandGap | 内部基准测量 | ⭐⭐⭐ |
| 13 | 比较器应用 | 模拟比较 | ⭐⭐ |
| **存储器** |
| 12 | EEPROM 读写 | 内部存储 | ⭐⭐ |
| **通信接口** |
| 14 | SPI 主从互传 | SPI 双向通信 | ⭐⭐⭐ |
| 15.1 | I2C AT24C02 | I2C 主机模式 | ⭐⭐⭐ |
| 15.2 | I2C 主从模式 | I2C 从机模式 | ⭐⭐⭐⭐ |
| 20.1 | SPI Flash | W25Q64 读写 | ⭐⭐⭐ |
| 29 | QSPI Flash | 四线高速访问 | ⭐⭐⭐⭐ |
| **PWM 应用** |
| 17 | PWM1~4 呼吸灯 | PWM 基础 | ⭐⭐ |
| 18 | PWM5~8 输出 | 高级 PWM | ⭐⭐⭐ |
| 19 | 高速 PWM | HSPWM 应用 | ⭐⭐⭐ |
| **DMA 传输** |
| 21 | DMA + ADC | 自动采样 | ⭐⭐⭐⭐ |
| 22 | DMA 内存拷贝 | M2M 传输 | ⭐⭐⭐ |
| 23 | DMA + UART | 高速串口 | ⭐⭐⭐⭐ |
| 24 | DMA + SPI | 高速 SPI | ⭐⭐⭐⭐ |
| 25 | DMA + LCM | 液晶屏接口 | ⭐⭐⭐⭐ |
| 26 | DMA + I2C | I2C DMA | ⭐⭐⭐⭐ |
| **其他** |
| 16 | RTC 时钟 | 实时时钟 | ⭐⭐ |
| 27~28 | USART LIN | LIN 总线 | ⭐⭐⭐⭐ |

---

## 💡 核心功能

### GPIO
- 4 种工作模式（准双向/高阻/开漏/推挽）
- 内部上拉/下拉可配置
- 施密特触发器
- 可调驱动能力

### 通信接口
- **4 路 UART** - 最高 115200+ 波特率
- **硬件 I2C** - 主/从模式，100kHz/400kHz
- **标准 SPI** - 主/从模式，最高 Fsys/2
- **QSPI** - 四线高速接口

### 定时器
- 6 个定时器（Timer0~4, Timer11）
- 16 位/8 位模式
- 可作波特率发生器
- 时钟输出功能

### 模拟功能
- **12 位 ADC** - 15 个外部通道 + 内部 BandGap
- **8 路高级 PWM** - 支持死区、互补输出、刹车
- **比较器** - 可配置参考电压

### DMA 控制器
- 多通道独立 DMA
- 支持 ADC/UART/SPI/I2C/LCM/M2M
- 减轻 CPU 负担

### USB 功能
- USB 2.0 全速设备（12Mbps）
- CDC（虚拟串口）/ HID（人机接口）
- 无需编写驱动

### 其他
- 内部 EEPROM
- RTC 实时时钟
- 看门狗定时器
- LCM 液晶屏接口

---

## 📚 学习路径

### 🌱 入门阶段（1-2 周）

1. **GPIO 基础**
   ```
   01-IO-跑马灯 → 按键输入 → LED 控制
   ```

2. **定时器 & 中断**
   ```
   02-Timer 测试 → 03-外中断测试 → 精确延时
   ```

3. **串口通信**
   ```
   05-串口 1 → Printf 输出 → 串口调试
   ```

### 🌿 进阶阶段（2-4 周）

4. **ADC 采样**
   ```
   10-多路 ADC → 电压测量 → 温度采集
   ```

5. **PWM 输出**
   ```
   17-PWM 呼吸灯 → 电机控制 → 舵机驱动
   ```

6. **通信接口**
   ```
   15-I2C AT24C02 → 20-SPI Flash → 传感器读取
   ```

### 🌳 高级阶段（4-8 周）

7. **DMA 应用**
   ```
   21-DMA+ADC → 23-DMA+UART → 高速数据传输
   ```

8. **USB 功能**
   ```
   USB CDC → USB HID → USB 设备开发
   ```

9. **综合应用**
   ```
   综合程序 → 多模块协同 → 完整项目开发
   ```

---

## 🔧 开发工具链

### 必需工具

| 工具 | 版本 | 用途 | 下载 |
|-----|------|------|------|
| Keil C51 | V9.0+ | 编译器 | [官网](https://www.keil.com) |
| STC-ISP | 最新版 | 下载工具 | [官网](http://www.stcai.com) |

### 推荐工具

| 工具 | 用途 |
|-----|------|
| 串口调试助手 | 串口通信调试 |
| 逻辑分析仪 | 波形分析 |
| 示波器 | 模拟信号测量 |

---

## 📖 文档说明

### 1. AI8051U-使用文档.md

**1000+ 行详细教程**，包含：
- 系统配置详解
- 各模块完整使用说明
- 丰富的代码示例
- 常见问题解答
- 完整 API 参考

**适合**：系统学习和深入了解

### 2. AI8051U-快速参考.md

**快速查找手册**，包含：
- 常用代码片段
- 配置模板
- 计算公式速查
- 中断向量表
- 寄存器速查

**适合**：日常开发时快速查阅

### 3. AI8051U库函数使用说明.pdf

**官方手册**，包含：
- 库函数详细说明
- 参数列表
- 应用实例
- 硬件连接图

**适合**：API 查询和硬件设计

---

## 🎓 最佳实践

### 代码风格

```c
// ✅ 推荐：清晰的初始化流程
void System_Init(void)
{
    WTST = 0;        // 系统初始化
    EAXSFR();
    CKCON = 0;
    SET_TPS();
    
    GPIO_Init();     // 模块初始化
    UART1_Init();
    Timer0_Init();
    
    EA = 1;          // 使能中断
}

// ✅ 推荐：使用宏定义提高可读性
#define LED_ON()    P00 = 0
#define LED_OFF()   P00 = 1

// ✅ 推荐：结构体配置
GPIO_InitTypeDef gpio;
gpio.Mode = GPIO_OUT_PP;
gpio.Pin = GPIO_Pin_All;
GPIO_Inilize(GPIO_P0, &gpio);
```

### 中断使用

```c
// ✅ 推荐：简短的中断服务程序
void UART1_ISR(void) interrupt UART1_VECTOR
{
    if(RI)
    {
        CLR_RI();
        RX_Buffer[RX_Cnt++] = SBUF;  // 简单处理
        RX_Flag = 1;                  // 设置标志
    }
}

// 主循环中处理
void main(void)
{
    while(1)
    {
        if(RX_Flag)
        {
            RX_Flag = 0;
            Process_RX_Data();  // 复杂处理放主循环
        }
    }
}
```

### 资源管理

```c
// ✅ 使用 xdata 存储大数组
u8 xdata large_buffer[1024];

// ✅ 使用 code 存储常量表
u8 code sin_table[256] = {...};

// ✅ 合理使用位变量
bit flag1, flag2, flag3;  // 节省内存
```

---

## ❓ 常见问题

### Q: 编译错误 "undefined symbol"？
**A**: 检查是否添加了所有需要的 `.c` 文件，特别是 `*_Isr.c` 中断文件。

### Q: 串口乱码？
**A**: 
1. 检查波特率设置
2. 确认主频配置正确（`config.h` 中的 `MAIN_Fosc`）
3. 对于高波特率，建议使用外部晶振

### Q: ADC 读数不稳定？
**A**:
1. GPIO 必须配置为高阻输入
2. 多次采样求平均
3. 增加硬件滤波电路

### Q: PWM 无输出？
**A**:
1. 检查 GPIO 是否配置为推挽输出
2. 确认 PWM 主输出已使能
3. 检查占空比设置

### Q: 如何选择时钟频率？
**A**:
- **串口应用**: 推荐 11.0592MHz 或 22.1184MHz（波特率精确）
- **通用应用**: 推荐 40MHz（性能最高）
- **低功耗**: 推荐 12MHz 或更低

---

## 📊 技术支持

- 🌐 **官方网站**: [www.stcai.com](http://www.stcai.com)
- 📧 **技术支持**: 联系 STC 官方
- 📱 **技术论坛**: STC 单片机论坛
- 📚 **资料下载**: 官网下载中心

---

## 📝 更新记录

### V2.0 (2025-04-10)
- ✨ 新增 QSPI Flash 访问示例
- 🔧 更新 USB 库到最新版本
- 📚 完善库函数使用说明书

### V1.x (2025-02-14)
- ✨ 增加普通 IO 口中断库文件与例子
- 🔧 增加 QSPI_Isr.c 文件
- 🐛 修复定时器 T11 功能

[查看完整更新记录](./UPDATE-NOTE.txt)

---

## 📄 许可证

本项目由 STC（宏晶科技）提供，仅供学习和开发使用。

---

## 🙏 致谢

感谢 STC（宏晶科技）提供完整的软件库和技术支持！

---

## 🚀 开始你的 AI8051U 开发之旅吧！

```
     _    ___ ___  ___  ____ _   _ 
    / \  |_ _( _ )/ _ \| ___/ | | |
   / _ \  | ||_ \| | | |___ \ | | |
  / ___ \ | |__) | |_| |___) | |_| |
 /_/   \_\___|____\___/|____/ \___/ 
                                    
        高性能 · 易开发 · 稳定可靠
```

**立即开始**: 打开 `独立程序/01-IO-跑马灯/`，开始你的第一个程序！

**学习文档**: 查看 [AI8051U-使用文档.md](./AI8051U-使用文档.md)

**快速查询**: 查看 [AI8051U-快速参考.md](./AI8051U-快速参考.md)

---

<p align="center">
  <sub>Made with ❤️ by STC (宏晶科技)</sub>
</p>

