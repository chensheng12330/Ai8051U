C251 COMPILER V5.60.0,  main                                                               16/04/25  23:09:24  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE main
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil_v5\C251\BIN\C251.EXE main.c XSMALL INTR2 BROWSE DEBUG TABS(2) 

stmt  level    source

    1          /*---------------------------------------------------------------------*/
    2          /* --- Web: www.STCAI.com ---------------------------------------------*/
    3          /*---------------------------------------------------------------------*/
    4          
    5          /*************  ¹¦ÄÜËµÃ÷    **************
    6          
    7          ±¾Àý³Ì»ùÓÚAI8051UÎªÖ÷¿ØÐ¾Æ¬µÄÊµÑéÏä½øÐÐ±àÐ´²âÊÔ.
    8          
    9          Ê¹ÓÃKeil C251±àÒëÆ÷£¬Memory ModelÍÆ¼öÉèÖÃXSmallÄ£Ê½£¬Ä¬ÈÏ¶¨Òå±äÁ¿ÔÚedata£¬µ¥Ê±ÖÓ´æÈ¡·ÃÎÊËÙ¶È¿ì¡£
   10          
   11          edata½¨Òé±£Áô1K¸ø¶ÑÕ»Ê¹ÓÃ£¬¿Õ¼ä²»¹»Ê±¿É½«´óÊý×é¡¢²»³£ÓÃ±äÁ¿¼Óxdata¹Ø¼ü×Ö¶¨Òåµ½xdata¿Õ¼ä¡£
   12          
   13          ¶¨Ê±Æ÷0×ö16Î»×Ô¶¯ÖØ×°, ÖÐ¶ÏÆµÂÊÎª1000HZ£¬×÷ÎªÊýÂë¹ÜÉ¨ÃèÏÔÊ¾.
   14          
   15          ¶¨Ê±Æ÷1×ö16Î»×Ô¶¯ÖØ×°, ÖÐ¶ÏÆµÂÊÎª10000HZ£¬×÷ÎªÂö³åÐÅºÅ¿í¶È¼ì²â.
   16          
   17          ÓÃSTCµÄMCUµÄIO·½Ê½¿ØÖÆ74HC595Çý¶¯8Î»ÊýÂë¹Ü¡£
   18          
   19          P33(INT1)¿Ú²úÉúµÍµçÆ½(ÓÃ»§¿É×Ô¶¨ÒåÐÞ¸Ä¶Ë¿Ú¸ú¼ì²âµçÆ½)Ê±½øÐÐ¼ÆÊ±£¬µçÆ½±ä»¯ºóÍ£Ö¹¼ÆÊ±¡£
   20          
   21          ÊýÂë¹ÜÏÔÊ¾Âö³åÐÅºÅ¿í¶È£¬µ¥Î»0.1ms£¬²âÁ¿·¶Î§0.1ms~6553.5ms.
   22          
   23          ÏÂÔØÊ±, Ñ¡ÔñÊ±ÖÓ 24MHZ (ÓÃ»§¿É×ÔÐÐÐÞ¸ÄÆµÂÊ).
   24          
   25          ******************************************/
   26          
   27          #include "..\..\comm\AI8051U.h"
   28          #include "stdio.h"
   29          #include "intrins.h"
   30          
   31          typedef   unsigned char u8;
   32          typedef   unsigned int  u16;
   33          typedef   unsigned long u32;
   34          
   35          #define MAIN_Fosc        24000000UL
   36          
   37          //==========================================================================
   38          
   39          #define Timer0_Reload   (MAIN_Fosc / 1000)      //Timer 0 ÖÐ¶ÏÆµÂÊ, 1000´Î/Ãë
   40          #define Timer1_Reload   (MAIN_Fosc / 10000)     //Timer 1 ÖÐ¶ÏÆµÂÊ, 10000´Î/Ãë
   41          
   42          #define DIS_DOT     0x20
   43          #define DIS_BLACK   0x10
   44          #define DIS_        0x11
   45          
   46          /*************  ±¾µØ³£Á¿ÉùÃ÷    **************/
   47          u8 code t_display[]={                       //±ê×¼×Ö¿â
   48          //   0    1    2    3    4    5    6    7    8    9    A    B    C    D    E    F
   49              0x3F,0x06,0x5B,0x4F,0x66,0x6D,0x7D,0x07,0x7F,0x6F,0x77,0x7C,0x39,0x5E,0x79,0x71,
   50          //black  -     H    J    K    L    N    o   P    U     t    G    Q    r   M    y
   51              0x00,0x40,0x76,0x1E,0x70,0x38,0x37,0x5C,0x73,0x3E,0x78,0x3d,0x67,0x50,0x37,0x6e,
   52              0xBF,0x86,0xDB,0xCF,0xE6,0xED,0xFD,0x87,0xFF,0xEF,0x46};    //0. 1. 2. 3. 4. 5. 6. 7. 8. 9. -1
   53          
   54          u8 code T_COM[]={0x01,0x02,0x04,0x08,0x10,0x20,0x40,0x80};      //Î»Âë
   55          
   56          /*************  IO¿Ú¶¨Òå    **************/
   57          sbit    P_HC595_SER   = P3^4;   //pin 14    SER     data input
   58          sbit    P_HC595_RCLK  = P3^5;   //pin 12    RCLk    store (latch) clock
   59          sbit    P_HC595_SRCLK = P3^2;   //pin 11    SRCLK   Shift data clock
C251 COMPILER V5.60.0,  main                                                               16/04/25  23:09:24  PAGE 2   

   60          
   61          /*************  ±¾µØ±äÁ¿ÉùÃ÷    **************/
   62          
   63          u8  LED8[8];        //ÏÔÊ¾»º³å
   64          u8  display_index;  //ÏÔÊ¾Î»Ë÷Òý
   65          bit B_1ms;          //1ms±êÖ¾
   66          u16 msecond;
   67          u16 Test_cnt;   //ÏÔÊ¾ÓÃµÄ¼ÆÊý±äÁ¿
   68          u16 Temp_cnt;   //²âÁ¿ÓÃµÄ¼ÆÊý±äÁ¿
   69          
   70          /*************  ±¾µØº¯ÊýÉùÃ÷    **************/
   71          
   72          void Timer0_init(void);
   73          void Timer1_init(void);
   74          void DisplayScan(void);
   75          void Display(void);
   76          
   77          /****************  Íâ²¿º¯ÊýÉùÃ÷ºÍÍâ²¿±äÁ¿ÉùÃ÷ *****************/
   78          
   79          
   80          /******************** Ö÷º¯Êý **************************/
   81          void main(void)
   82          {
   83   1          u8  i;
   84   1          
   85   1          WTST = 0;  //ÉèÖÃ³ÌÐòÖ¸ÁîÑÓÊ±²ÎÊý£¬¸³ÖµÎª0¿É½«CPUÖ´ÐÐÖ¸ÁîµÄËÙ¶ÈÉèÖÃÎª×î¿ì
   86   1          EAXFR = 1; //À©Õ¹¼Ä´æÆ÷(XFR)·ÃÎÊÊ¹ÄÜ
   87   1          CKCON = 0; //Ìá¸ß·ÃÎÊXRAMËÙ¶È
   88   1      
   89   1          P0M1 = 0x00;   P0M0 = 0x00;   //ÉèÖÃÎª×¼Ë«Ïò¿Ú
   90   1          P1M1 = 0x00;   P1M0 = 0x00;   //ÉèÖÃÎª×¼Ë«Ïò¿Ú
   91   1          P2M1 = 0x00;   P2M0 = 0x00;   //ÉèÖÃÎª×¼Ë«Ïò¿Ú
   92   1          P3M1 = 0x00;   P3M0 = 0x00;   //ÉèÖÃÎª×¼Ë«Ïò¿Ú
   93   1          P4M1 = 0x00;   P4M0 = 0x00;   //ÉèÖÃÎª×¼Ë«Ïò¿Ú
   94   1          P5M1 = 0x00;   P5M0 = 0x00;   //ÉèÖÃÎª×¼Ë«Ïò¿Ú
   95   1          P6M1 = 0x00;   P6M0 = 0x00;   //ÉèÖÃÎª×¼Ë«Ïò¿Ú
   96   1          P7M1 = 0x00;   P7M0 = 0x00;   //ÉèÖÃÎª×¼Ë«Ïò¿Ú
   97   1      
   98   1          Test_cnt = 0;
   99   1          Temp_cnt = 0;
  100   1          for(i=0; i<8; i++)  LED8[i] = DIS_BLACK;    //ÉÏµçÏûÒþ
  101   1          
  102   1          Timer0_init();
  103   1          Timer1_init();
  104   1          EA = 1;     //´ò¿ª×ÜÖÐ¶Ï
  105   1      
  106   1          while (1)
  107   1          {
  108   2              if(B_1ms)   //1msµ½
  109   2              {
  110   3                  B_1ms = 0;
  111   3                  if(++msecond >= 1000)   //1Ãëµ½
  112   3                  {
  113   4                      msecond = 0;        //Çå1000ms¼ÆÊý
  114   4                      Display();          //ÏÔÊ¾Ãë¼ÆÊý
  115   4                  }
  116   3              }
  117   2          }
  118   1      }
  119          
  120          //========================================================================
  121          // º¯Êý: void Timer0_init(void)
  122          // ÃèÊö: timer0³õÊ¼»¯º¯Êý.
  123          // ²ÎÊý: none.
  124          // ·µ»Ø: none.
  125          // °æ±¾: V1.0, 2015-1-12
C251 COMPILER V5.60.0,  main                                                               16/04/25  23:09:24  PAGE 3   

  126          //========================================================================
  127          void Timer0_init(void)
  128          {
  129   1              TR0 = 0;    //Í£Ö¹¼ÆÊý
  130   1      
  131   1          #if (Timer0_Reload < 64)    // Èç¹ûÓÃ»§ÉèÖÃÖµ²»ºÏÊÊ£¬ Ôò²»Æô¶¯¶¨Ê±Æ÷
                       #error "Timer0ÉèÖÃµÄÖÐ¶Ï¹ý¿ì!"
               
                   #elif ((Timer0_Reload/12) < 65536UL)    // Èç¹ûÓÃ»§ÉèÖÃÖµ²»ºÏÊÊ£¬ Ôò²»Æô¶¯¶¨Ê±Æ÷
  135   1              ET0 = 1;    //ÔÊÐíÖÐ¶Ï
  136   1          //  PT0 = 1;    //¸ßÓÅÏÈ¼¶ÖÐ¶Ï
  137   1              TMOD &= ~0x03;
  138   1              TMOD |= 0;  //¹¤×÷Ä£Ê½, 0: 16Î»×Ô¶¯ÖØ×°, 1: 16Î»¶¨Ê±/¼ÆÊý, 2: 8Î»×Ô¶¯ÖØ×°, 3: 16Î»×Ô¶¯ÖØ×°, ²»¿ÉÆ
             -Á±ÎÖÐ¶Ï
  139   1          //  T0_CT = 1;  //¼ÆÊý
  140   1              T0_CT = 0;  //¶¨Ê±
  141   1          //  T0CLKO = 1; //Êä³öÊ±ÖÓ
  142   1              T0CLKO = 0; //²»Êä³öÊ±ÖÓ
  143   1      
  144   1              #if (Timer0_Reload < 65536UL)
  145   1                  T0x12 = 1;  //1T mode
  146   1                  TH0 = (u8)((65536UL - Timer0_Reload) / 256);
  147   1                  TL0 = (u8)((65536UL - Timer0_Reload) % 256);
  148   1              #else
                           T0x12 = 0;  //12T mode
                           TH0 = (u8)((65536UL - Timer0_Reload/12) / 256);
                           TL0 = (u8)((65536UL - Timer0_Reload/12) % 256);
                       #endif
  153   1      
  154   1              TR0 = 1;    //¿ªÊ¼ÔËÐÐ
  155   1      
  156   1          #else
                       #error "Timer0ÉèÖÃµÄÖÐ¶Ï¹ýÂý!"
                   #endif
  159   1      }
  160          
  161          //========================================================================
  162          // º¯Êý: void Timer1_init(void)
  163          // ÃèÊö: timer1³õÊ¼»¯º¯Êý.
  164          // ²ÎÊý: none.
  165          // ·µ»Ø: none.
  166          // °æ±¾: V1.0, 2015-1-12
  167          //========================================================================
  168          void Timer1_init(void)
  169          {
  170   1              TR1 = 0;    //Í£Ö¹¼ÆÊý
  171   1      
  172   1          #if (Timer1_Reload < 64)    // Èç¹ûÓÃ»§ÉèÖÃÖµ²»ºÏÊÊ£¬ Ôò²»Æô¶¯¶¨Ê±Æ÷
                       #error "Timer1ÉèÖÃµÄÖÐ¶Ï¹ý¿ì!"
               
                   #elif ((Timer1_Reload/12) < 65536UL)    // Èç¹ûÓÃ»§ÉèÖÃÖµ²»ºÏÊÊ£¬ Ôò²»Æô¶¯¶¨Ê±Æ÷
  176   1              ET1 = 1;    //ÔÊÐíÖÐ¶Ï
  177   1          //  PT1 = 1;    //¸ßÓÅÏÈ¼¶ÖÐ¶Ï
  178   1              TMOD &= ~0x30;
  179   1              TMOD |= (0 << 4);   //¹¤×÷Ä£Ê½, 0: 16Î»×Ô¶¯ÖØ×°, 1: 16Î»¶¨Ê±/¼ÆÊý, 2: 8Î»×Ô¶¯ÖØ×°
  180   1          //  T1_CT = 1;  //¼ÆÊý
  181   1              T1_CT = 0;  //¶¨Ê±
  182   1          //  T1CLKO = 1; //Êä³öÊ±ÖÓ
  183   1              T1CLKO = 0; //²»Êä³öÊ±ÖÓ
  184   1      
  185   1              #if (Timer1_Reload < 65536UL)
  186   1                  T1x12 = 1;  //1T mode
  187   1                  TH1 = (u8)((65536UL - Timer1_Reload) / 256);
  188   1                  TL1 = (u8)((65536UL - Timer1_Reload) % 256);
  189   1              #else
                           T1x12 = 0;  //12T mode
C251 COMPILER V5.60.0,  main                                                               16/04/25  23:09:24  PAGE 4   

                           TH1 = (u8)((65536UL - Timer1_Reload/12) / 256);
                           TL1 = (u8)((65536UL - Timer1_Reload/12) % 256);
                       #endif
  194   1      
  195   1              TR1 = 1;    //¿ªÊ¼ÔËÐÐ
  196   1      
  197   1          #else
                       #error "Timer1ÉèÖÃµÄÖÐ¶Ï¹ýÂý!"
                   #endif
  200   1      }
  201          
  202          //========================================================================
  203          // º¯Êý: void timer0_int (void) interrupt TIMER0_VECTOR
  204          // ÃèÊö:  timer0ÖÐ¶Ïº¯Êý.
  205          // ²ÎÊý: none.
  206          // ·µ»Ø: none.
  207          // °æ±¾: V1.0, 2015-1-12
  208          //========================================================================
  209          void timer0_int (void) interrupt 1
  210          {
  211   1          DisplayScan();  //1msÉ¨ÃèÏÔÊ¾Ò»Î»
  212   1          B_1ms = 1;      //1ms±êÖ¾
  213   1      }
  214          
  215          //========================================================================
  216          // º¯Êý: void timer1_int (void) interrupt TIMER1_VECTOR
  217          // ÃèÊö:  timer1ÖÐ¶Ïº¯Êý.
  218          // ²ÎÊý: none.
  219          // ·µ»Ø: none.
  220          // °æ±¾: V1.0, 2015-1-12
  221          //========================================================================
  222          void timer1_int (void) interrupt 3
  223          {
  224   1         if(!P33)
  225   1         {
  226   2            Temp_cnt++;
  227   2         }
  228   1         else
  229   1         {
  230   2            if(Temp_cnt>10)   //ÓÐÐ§ÐÅºÅ > 1ms
  231   2            {
  232   3               Test_cnt = Temp_cnt;
  233   3            }
  234   2            Temp_cnt = 0;
  235   2         }
  236   1      }
  237          
  238          /**************** ÏòHC595·¢ËÍÒ»¸ö×Ö½Úº¯Êý ******************/
  239          void Send_595(u8 dat)
  240          {
  241   1          u8  i;
  242   1          for(i=0; i<8; i++)
  243   1          {
  244   2              dat <<= 1;
  245   2              P_HC595_SER   = CY;
  246   2              P_HC595_SRCLK = 1;
  247   2              P_HC595_SRCLK = 0;
  248   2          }
  249   1      }
  250          
  251          /********************** ÏÔÊ¾É¨Ãèº¯Êý ************************/
  252          void DisplayScan(void)
  253          {
  254   1          Send_595(t_display[LED8[display_index]]);   //Êä³ö¶ÎÂë
  255   1          Send_595(~T_COM[display_index]);            //Êä³öÎ»Âë
  256   1      
C251 COMPILER V5.60.0,  main                                                               16/04/25  23:09:24  PAGE 5   

  257   1          P_HC595_RCLK = 1;
  258   1          P_HC595_RCLK = 0;
  259   1         if(++display_index >= 8)   display_index = 0;  //8Î»½áÊø»Ø0
  260   1      }
  261          
  262          /********************** ÏÔÊ¾¼ÆÊýº¯Êý ************************/
  263          void Display(void)
  264          {
  265   1          u8  i;
  266   1          
  267   1          LED8[3] = Test_cnt / 10000;
  268   1          LED8[4] = (Test_cnt % 10000) / 1000;
  269   1          LED8[5] = (Test_cnt % 1000) / 100;
  270   1          LED8[6] = (Test_cnt % 100) / 10;
  271   1          LED8[7] = Test_cnt % 10;
  272   1          
  273   1          for(i=3; i<7; i++)  //ÏûÎÞÐ§0
  274   1          {
  275   2              if(LED8[i] > 0) break;
  276   2              LED8[i] = DIS_BLACK;
  277   2          }
  278   1      }


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       517     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =        15     ------
  bit size             =         1     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =    ------     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
