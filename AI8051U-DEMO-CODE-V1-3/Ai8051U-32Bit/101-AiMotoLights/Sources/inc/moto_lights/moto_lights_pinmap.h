/*---------------------------------------------------------------------*/
/* --- 摩托车智能联动灯组系统 - 引脚映射定义 -------------------------*/
/*---------------------------------------------------------------------*/

#ifndef __MOTO_LIGHTS_PINMAP_H_
#define __MOTO_LIGHTS_PINMAP_H_

#include "../../../AI8051U/AI8051U.h"

//========================================================================
//                          系统调试和通信引脚
//========================================================================
// P5.2、P5.3 - UART4日志调试通信
// P3.0、P3.1 - 程序烧写接口

//========================================================================
//                          系统控制和状态引脚
//========================================================================
#define PIN_POWER_DETECT    P46   // P4.6 掉电检测输入
#define PIN_LED_STATUS_OK   P17   // P1.7 运行状态指示灯(蓝色)
#define PIN_LED_STATUS_ERR  P16   // P1.6 错误状态指示灯(红色)
#define PIN_SYSTEM_RESET    P47   // P4.7 程序复位按键输入

//========================================================================
//                          用户交互按键（外部中断）
//========================================================================
#define PIN_KEY_BRIGHTNESS  P32   // P3.2 LED亮度调节按键, INT3
#define PIN_KEY_MENU        P37   // P3.7 功能菜单按键, INT0
#define PIN_KEY_TEST        P36   // P3.6 功能测试按键, INT2

// 按键编号映射
#define KEY_MENU            1     // KEY_INT0 -> 菜单按键
#define KEY_TEST            3     // KEY_INT2 -> 测试按键  
#define KEY_BRIGHTNESS      4     // KEY_INT3 -> 亮度按键

//========================================================================
//                          原车信号输入（P0口）
//========================================================================
#define PIN_IN_BRAKE        P00   // P0.0 刹车信号输入
#define PIN_IN_FOG_LIGHT    P01   // P0.1 雾灯开启信号输入
#define PIN_IN_NEAR_LIGHT   P02   // P0.2 近光灯开启信号输入
#define PIN_IN_FAR_LIGHT    P03   // P0.3 远光灯开启信号输入
#define PIN_IN_TURN_LEFT    P04   // P0.4 左转向灯信号输入
#define PIN_IN_TURN_RIGHT   P05   // P0.5 右转向灯信号输入
#define PIN_IN_AUDIO_SIGNAL P06   // P0.6 音频模拟信号输入(ADC)
#define PIN_IN_BATTERY_VOL  P07   // P0.7 电瓶电压信号输入(ADC)

// ADC通道映射
#define ADC_CH_AUDIO        6     // P0.6 音频信号ADC通道
#define ADC_CH_BATTERY      7     // P0.7 电压信号ADC通道
// 注意：光强传感器暂时禁用（原P1.5已用作蜂鸣器，引脚冲突）
// 如需使用光强传感器，请：
// 1. 将传感器连接到其他ADC通道（如P3.0/P3.1等未使用的ADC引脚）
// 2. 修改下面的ADC_CH_LIGHT_SENSE定义
// 3. 更新System_init.c中对应引脚的GPIO配置为高阻输入(ADC模式)
#define ADC_CH_LIGHT_SENSE  P06 // 当前禁用（P1.5冲突），请根据实际硬件连接修改 [暂时利用P0.6]

//========================================================================
//                          输出设备控制
//========================================================================
#define PIN_OUT_BRAKE_LED   P10   // P1.0 尾箱刹车灯控制(PWM)
#define PIN_OUT_RGB_RED     P11   // P1.1 前轮车底RGB红色(PWM)
#define PIN_OUT_RGB_GREEN   P12   // P1.2 前轮车底RGB绿色(PWM)
#define PIN_OUT_RGB_BLUE    P13   // P1.3 前轮车底RGB蓝色(PWM)
#define PIN_OUT_BUZZER      P15   // P1.5 蜂鸣器控制(PWM)

// 状态指示LED
#define PIN_LED_STATUS_OK   P17   // P1.7 运行状态指示灯(蓝色)
#define PIN_LED_STATUS_ERR  P16   // P1.6 错误状态指示灯(红色)

//========================================================================
//                          WS2812B氛围灯控制（使用SPI1-DMA）
//========================================================================
// 使用SPI1接口，引脚为P2.4/P2.5/P2.6/P2.7
// 注意：使用SPI1模式时，以下引脚被占用：
//   P2.4 - SS（本设计不使用）
//   P2.5 - MOSI（WS2812B数据输出）⭐
//   P2.6 - MISO（需设为高阻+下拉，确保空闲时为低）
//   P2.7 - SCLK（SPI时钟）
#define PIN_OUT_WS2812B     P25   // P2.5 WS2812B数据输出(SPI1-MOSI)
#define WS2812B_LED_COUNT   90    // WS2812B灯珠数量
#define WS2812B_SPI_BYTES   (WS2812B_LED_COUNT * 12)  // SPI字节数(每个LED 12字节)

//========================================================================
//                          端口模式配置宏
//========================================================================
// GPIO模式：
//   准双向口(00): P?M1=0, P?M0=0 (默认,可输入输出,有上拉)
//   推挽输出(01): P?M1=0, P?M0=1 (强驱动输出)
//   高阻输入(10): P?M1=1, P?M0=0 (纯输入)
//   开漏输出(11): P?M1=1, P?M0=1 (需外部上拉)

//========================================================================
//                          信号极性定义
//========================================================================
// 原车信号极性（上升沿触发，高电平有效）
#define SIGNAL_ACTIVE       1     // 信号激活状态
#define SIGNAL_INACTIVE     0     // 信号未激活状态

// LED状态极性
#define LED_ON              1     // LED点亮
#define LED_OFF             0     // LED熄灭

//========================================================================
//                          系统电压阈值定义
//========================================================================
#define BATTERY_LOW_VOLTAGE     11.0f   // 电瓶低电压报警(V)
#define BATTERY_NORMAL_VOLTAGE  12.0f   // 电瓶正常电压(V)
#define BATTERY_HIGH_VOLTAGE    14.5f   // 电瓶充电电压(V)

//========================================================================
//                          光强阈值定义
//========================================================================
#define LIGHT_THRESHOLD_DAY     800    // 白天模式阈值(ADC值0-4095)
#define LIGHT_THRESHOLD_NIGHT   300    // 夜晚模式阈值(ADC值0-4095)

#endif  // __MOTO_LIGHTS_PINMAP_H_

