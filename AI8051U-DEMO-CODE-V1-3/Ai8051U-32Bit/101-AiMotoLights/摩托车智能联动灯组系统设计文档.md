# 摩托车智能联动灯组系统 - 设计文档

## 项目概述

### 项目名称
摩托车智能联动灯组系统 (Motorcycle Smart Light System)

### 版本信息
- 版本：V1.0
- 日期：2025-11-17
- 作者：Sherwin.Chen

### 项目简介
基于AI8051U单片机的摩托车智能联动灯组系统，通过检测原车信号和传感器数据，自动控制多种灯光效果，提升摩托车的安全性和美观性。

---

## 系统架构

### 总体架构

```
┌─────────────────────────────────────────────────────────────┐
│                       AI8051U (48MHz)                        │
├─────────────────────────────────────────────────────────────┤
│  输入层                │  处理层              │  输出层       │
├──────────────────────┼────────────────────┼──────────────┤
│ • 原车信号检测        │ • 优先级调度器      │ • WS2812B    │
│   - 刹车              │ • 场景渲染引擎      │   (90颗)     │
│   - 转向灯            │ • 灯光效果生成      │ • RGB灯组    │
│   - 远近光            │ • 事件处理          │   (3路PWM)   │
│   - 位置灯            │ • 状态机管理        │ • 刹车灯     │
│   - 雾灯              │                    │   (PWM)      │
│   - 喇叭              │                    │ • 蜂鸣器     │
│                       │                    │   (PWM)      │
│ • 传感器采集          │                    │ • 状态指示   │
│   - 光强传感器        │                    │   (LED)      │
│   - 电池电压          │                    │              │
│   - 音频信号          │                    │              │
│                       │                    │              │
│ • 用户交互            │                    │              │
│   - 菜单按键          │                    │              │
│   - 测试按键          │                    │              │
│   - 亮度按键          │                    │              │
└──────────────────────┴────────────────────┴──────────────┘
```

### 模块层次结构

```
main.c
 ├─ System_init.c          // 系统初始化
 ├─ Task.c                 // 任务调度
 └─ app.c                  // 应用配置
     │
     ├─ app_moto_lights.c       // 主应用层（协调器）
     │   ├─ app_vehicle_signal.c   // 原车信号检测
     │   ├─ app_sensors.c          // 传感器管理
     │   ├─ app_intKey.c           // 按键输入
     │   ├─ app_light_scheduler.c  // 灯光调度器
     │   ├─ app_ws2812b.c          // WS2812B控制
     │   └─ app_pwm_output.c       // PWM输出控制
     │
     └─ Config Files
         ├─ moto_lights_config.h   // 系统配置
         └─ moto_lights_pinmap.h   // 引脚映射
```

---

## 硬件配置

### MCU引脚分配

#### P0口 - 输入信号组
| 引脚  | 功能           | 类型        | 说明                    |
|------|----------------|------------|------------------------|
| P0.0 | 刹车信号        | 数字输入    | 上升沿触发，高电平有效    |
| P0.1 | 雾灯信号        | 数字输入    | 上升沿触发，高电平有效    |
| P0.2 | 近光灯信号      | 数字输入    | 上升沿触发，高电平有效    |
| P0.3 | 远光灯信号      | 数字输入    | 上升沿触发，高电平有效    |
| P0.4 | 左转向信号      | 数字输入    | 上升沿触发，高电平有效    |
| P0.5 | 右转向信号      | 数字输入    | 上升沿触发，高电平有效    |
| P0.6 | 音频信号        | ADC输入     | ADC通道6，音频频谱分析   |
| P0.7 | 电瓶电压        | ADC输入     | ADC通道7，电压监控       |

#### P1口 - PWM输出组
| 引脚  | 功能           | 类型        | 说明                    |
|------|----------------|------------|------------------------|
| P1.0 | 尾箱刹车灯      | PWM输出     | 软件PWM，8位分辨率       |
| P1.1 | RGB红色通道     | PWM输出     | 前轮+车底RGB灯红色       |
| P1.2 | RGB绿色通道     | PWM输出     | 前轮+车底RGB灯绿色       |
| P1.3 | RGB蓝色通道     | PWM输出     | 前轮+车底RGB灯蓝色       |
| P1.5 | 蜂鸣器          | PWM输出     | 声音提示                |
| P1.6 | 错误指示LED     | 数字输出    | 红色LED，系统错误指示    |
| P1.7 | 状态指示LED     | 数字输出    | 蓝色LED，系统状态指示    |

#### P2口 - WS2812B输出
| 引脚  | 功能           | 类型        | 说明                    |
|------|----------------|------------|------------------------|
| P2.5 | WS2812B数据     | 数字输出    | 800kHz数据速率，90颗灯珠 |

#### P3口 - 按键输入（外部中断）
| 引脚  | 功能           | 类型        | 说明                    |
|------|----------------|------------|------------------------|
| P3.2 | 亮度调节按键    | 外部中断    | INT3，下降沿触发         |
| P3.6 | 功能测试按键    | 外部中断    | INT2，下降沿触发         |
| P3.7 | 菜单按键        | 外部中断    | INT0，下降沿触发         |

#### P4口 - 系统控制
| 引脚  | 功能           | 类型        | 说明                    |
|------|----------------|------------|------------------------|
| P4.6 | 掉电检测        | 数字输入    | 掉电保护                |
| P4.7 | 系统复位按键    | 数字输入    | 硬件复位                |

#### P5口 - 调试通信
| 引脚  | 功能           | 类型        | 说明                    |
|------|----------------|------------|------------------------|
| P5.2 | UART4 RX       | UART输入    | 115200波特率，调试日志   |
| P5.3 | UART4 TX       | UART输出    | 115200波特率，调试日志   |

### 外部器件连接

#### WS2812B灯珠分区（总共90颗）
```
前左区域: 0-14    (15颗)  ┌─────────────┐
前右区域: 15-29   (15颗)  │   前轮区域   │
车身左侧: 30-49   (20颗)  ├─────────────┤
车身右侧: 50-69   (20颗)  │   车身区域   │
尾部区域: 70-89   (20颗)  ├─────────────┤
                          │   尾部区域   │
                          └─────────────┘
```

#### RGB灯组
- 前轮RGB灯 + 车底RGB灯（共用3路PWM）
- 支持256级亮度调节
- 支持多种效果（静态、呼吸、闪烁）

#### 电压分压电路
```
电瓶(12V) ─┬─ R1(20K) ─┬─ P0.7 (ADC)
          │            │
          │          R2(10K)
          │            │
         GND          GND

实际电压 = (ADC值 / 4096) * 5V * (R1+R2)/R2
```

---

## 软件设计

### 优先级机制

系统采用基于优先级的场景调度机制：

```
优先级（高到低）：
┌────────────────────────────────┐
│ 100: 刹车场景                   │  ← 最高优先级
├────────────────────────────────┤
│  90: 转向场景（左/右）          │
├────────────────────────────────┤
│  80: 位置灯场景                 │
├────────────────────────────────┤
│  70: 远近光场景                 │
├────────────────────────────────┤
│  65: 喇叭效果场景               │
├────────────────────────────────┤
│  60: 音频频谱场景               │
├────────────────────────────────┤
│  50: 环境光效场景               │
├────────────────────────────────┤
│   0: 空闲场景                   │  ← 默认场景
└────────────────────────────────┘
```

**调度规则：**
1. 高优先级场景会覆盖低优先级场景
2. 同优先级场景按激活顺序执行
3. 场景可设置持续时间，超时自动失效
4. 空闲场景始终存在，作为默认场景

### 场景定义

#### 1. 刹车场景 (SCENE_BRAKE)
**触发条件：** 刹车信号激活  
**优先级：** 100（最高）  
**持续时间：** 持续到刹车信号释放  
**效果：**
- 尾箱刹车灯：全亮（255）
- WS2812B尾部区域：红色高亮
- RGB灯组：红色

#### 2. 左转向场景 (SCENE_TURN_LEFT)
**触发条件：** 左转向信号激活  
**优先级：** 90  
**持续时间：** 持续到转向信号释放  
**效果：**
- WS2812B左侧区域：橙色流水效果（从前到后）
- 流水速度：500ms完整周期
- 右侧区域：暗

#### 3. 右转向场景 (SCENE_TURN_RIGHT)
**触发条件：** 右转向信号激活  
**优先级：** 90  
**持续时间：** 持续到转向信号释放  
**效果：**
- WS2812B右侧区域：橙色流水效果（从前到后）
- 流水速度：500ms完整周期
- 左侧区域：暗

#### 4. 位置灯场景 (SCENE_POSITION_LIGHT)
**触发条件：** 雾灯信号激活  
**优先级：** 80  
**持续时间：** 持续到雾灯信号释放  
**效果：**
- 所有灯光：低亮度（50）
- 尾箱刹车灯：每2秒闪烁一次
- RGB灯组：白色低亮度

#### 5. 近光灯场景 (SCENE_NEAR_LIGHT)
**触发条件：** 近光灯信号激活  
**优先级：** 70  
**持续时间：** 持续到近光灯信号释放  
**效果：**
- 所有灯光：中等亮度（128）白色
- RGB灯组：白色中等亮度

#### 6. 远光灯场景 (SCENE_FAR_LIGHT)
**触发条件：** 远光灯信号激活  
**优先级：** 70  
**持续时间：** 持续到远光灯信号释放  
**效果：**
- WS2812B：白色快闪（200ms周期）
- RGB灯组：白色快闪

#### 7. 喇叭效果场景 (SCENE_HORN_EFFECT)
**触发条件：** 音频检测到喇叭信号  
**优先级：** 65  
**持续时间：** 3秒  
**效果：**
- 前轮RGB灯组：红色快闪
- WS2812B前部区域：红色快闪
- 提醒周围车辆注意

#### 8. 音频频谱场景 (SCENE_AUDIO_SPECTRUM)
**触发条件：** 检测到音频信号  
**优先级：** 60  
**持续时间：** 持续到音频消失  
**效果：**
- WS2812B：显示8频段频谱
- 颜色随频段变化（彩虹色）

### 灯光效果类型

#### 静态效果 (EFFECT_STATIC)
- 固定颜色和亮度
- 无动画

#### 呼吸效果 (EFFECT_BREATHING)
```
亮度变化曲线：
  255 ─┐     ┌─
       │    │
       │   │
       │  │
       │ │
    0 ─┴─┘
       0   1000  2000  3000 (ms)
```
- 周期：可配置（默认2秒）
- 亮度：0-255正弦/三角波

#### 流水效果 (EFFECT_FLOWING)
```
流动方向：
  LED0 → LED1 → LED2 → ... → LEDn
    ●     ◐     ○     ○     ○
```
- 带拖尾效果（5颗LED）
- 速度可配置
- 用于转向灯

#### 闪烁效果 (EFFECT_FLASHING)
```
状态：
  ON  ━━━     ━━━     ━━━
  OFF     ━━━     ━━━     ━━━
       0  500 1000 1500 2000 (ms)
```
- 占空比：50%
- 周期可配置

#### 彩虹效果 (EFFECT_RAINBOW)
```
颜色循环：
  红 → 橙 → 黄 → 绿 → 青 → 蓝 → 紫 → 红
  (HSV色彩空间 0° → 360°)
```
- 全LED渐变
- 速度可配置

#### 频谱效果 (EFFECT_SPECTRUM)
```
频谱显示（8频段）：
  █           █
  █     █ █   █ █
  █ █   █ █   █ █
  █ █ █ █ █ █ █ █
  ─────────────────
  低           高频
```
- 实时音频FFT
- 频段数：8
- 颜色映射

### 工作模式

#### 白天模式 (MODE_DAY)
**触发条件：** 光强 > 800 (ADC值)  
**特点：**
- WS2812B亮度：180 (注重穿透性)
- RGB灯组：高亮度
- 效果：简洁、明快

#### 夜晚模式 (MODE_NIGHT)
**触发条件：** 光强 < 300 (ADC值)  
**特点：**
- WS2812B亮度：255 (最大亮度)
- RGB灯组：中等亮度
- 效果：绚丽、醒目

**模式切换：**
- 采用滞回判断，防止频繁切换
- 每500ms检测一次光强

### 任务调度

系统采用协作式多任务调度，基于Timer0的1ms时基：

| 任务名称                | 周期   | 功能描述                    |
|------------------------|--------|----------------------------|
| Sample_VehicleSignal   | 10ms   | 原车信号检测与消抖          |
| Sample_PWM_Output      | 10ms   | PWM输出更新                |
| Sample_intKey          | 10ms   | 按键扫描与消抖              |
| Sample_LightScheduler  | 20ms   | 灯光场景调度与渲染          |
| Sample_MotoLights_App  | 50ms   | 主应用逻辑处理              |
| Sample_Sensors         | 100ms  | 传感器采样（ADC）           |
| Sample_StatusIndicator | 100ms  | 状态LED控制                |
| CPUMonitor_Calculate   | 1000ms | CPU占用率计算              |
| TaskMonitor_Report     | 5000ms | 任务性能监控报告            |

**任务执行时序：**
```
Timer0 1ms中断 ────┬────────┬────────┬────────┬────────
                   │        │        │        │
                   ↓        ↓        ↓        ↓
Task1(10ms)    ────●────────●────────●────────●────
Task2(20ms)    ────●────────────────●─────────────
Task3(50ms)    ────●───────────────────────────────
Task4(100ms)   ────●───────────────────────────────
```

### 按键功能

#### 菜单按键 (P3.7, INT0)
- **短按：** 进入/退出测试模式
- **长按：** 无功能

#### 测试按键 (P3.6, INT2)
- **短按：** 测试所有灯光（全亮）
- **长按：** 顺序测试各区域

#### 亮度按键 (P3.2, INT3)
- **短按：** 循环调节亮度（33% → 66% → 100% → 33%...）
- **长按：** 无功能

**按键特性：**
- 硬件消抖：下降沿中断
- 软件消抖：20ms确认
- 长按检测：500ms
- 重复触发：长按后每200ms

---

## 使用说明

### 系统启动

1. **上电自检：**
   - 蓝色状态LED常亮
   - 蜂鸣器短鸣3次（100ms间隔）
   - UART输出启动信息

2. **初始化完成标志：**
   ```
   ========================================
   Motorcycle Smart Light System
   Version: 1.0
   ========================================
   
   System initialized successfully!
   System state: NORMAL
   ```

3. **默认状态：**
   - 所有灯光关闭（空闲场景）
   - 等待原车信号触发

### 正常使用流程

```
原车信号输入 → 信号检测 → 优先级调度 → 场景渲染 → 灯光输出
     ↓              ↓            ↓           ↓          ↓
   刹车踩下      消抖处理    选择最高优先级  渲染刹车效果  全部LED
   左转拨动      边沿检测    激活刹车场景    红色高亮      更新显示
```

**示例场景：**

1. **刹车 + 左转同时触发：**
   - 刹车场景优先级100 > 左转场景优先级90
   - 显示刹车效果（红色高亮）
   - 转向信号被抑制

2. **位置灯 + 音频频谱：**
   - 位置灯优先级80 > 音频频谱优先级60
   - 显示位置灯效果（低亮度）
   - 音频频谱被抑制

### 测试模式

**进入方法：** 短按菜单按键  
**退出方法：** 再次短按菜单按键

**测试内容：**
1. WS2812B彩虹效果（全LED）
2. RGB灯组循环变色
3. 刹车灯闪烁
4. 蜂鸣器每2秒短鸣一次
5. 状态LED双色闪烁

**测试模式特点：**
- 优先级最高（100）
- 屏蔽所有原车信号
- 用于功能验证

### 亮度调节

**操作：** 短按亮度按键  
**效果：** 循环切换3档亮度

| 档位 | 亮度值 | 百分比 | 说明       |
|-----|--------|--------|-----------|
| 1   | 85     | 33%    | 低亮度     |
| 2   | 170    | 66%    | 中亮度     |
| 3   | 255    | 100%   | 最高亮度   |

**提示音：** 每次切换蜂鸣器短鸣一声

### 状态指示

#### 蓝色状态LED (P1.7)
| 状态       | LED表现     | 说明               |
|-----------|-------------|-------------------|
| 正常运行   | 常亮        | 系统正常工作       |
| 低电量     | 快闪(200ms) | 电池电压 < 11V    |
| 测试模式   | 慢闪(1000ms)| 处于测试模式       |

#### 红色错误LED (P1.6)
| 状态       | LED表现     | 说明               |
|-----------|-------------|-------------------|
| 无错误     | 熄灭        | 系统正常           |
| 系统错误   | 快闪(200ms) | 出现系统错误       |
| 测试模式   | 慢闪(1000ms)| 与蓝色LED同步      |

### 调试输出

**连接方式：**
- P5.2 (RX) → USB转串口模块 TX
- P5.3 (TX) → USB转串口模块 RX
- GND → GND

**串口配置：**
- 波特率：115200
- 数据位：8
- 停止位：1
- 校验位：无
- 流控：无

**输出信息：**
```
[KEY] KEY1(INT0) SHORT
  -> Enter test mode
[SIGNAL] BRAKE: ON
Scene changed to: 1
[INFO] System running: 60 seconds
  Battery: 12.50V, Light: 650, Scene: 1
```

---

## 配置参数

### 可调参数（moto_lights_config.h）

#### 优先级配置
```c
#define PRIORITY_BRAKE          100  // 刹车优先级
#define PRIORITY_TURN_SIGNAL    90   // 转向优先级
#define PRIORITY_POSITION_LIGHT 80   // 位置灯优先级
#define PRIORITY_HEADLIGHT      70   // 远近光优先级
#define PRIORITY_AUDIO_SPECTRUM 60   // 音频频谱优先级
```

#### 定时参数
```c
#define DEBOUNCE_TIME_MS        20   // 消抖时间(ms)
#define TURN_SIGNAL_BLINK_MS    500  // 转向灯闪烁周期
#define HORN_EFFECT_DURATION_MS 3000 // 喇叭效果持续时间
```

#### PWM参数
```c
#define PWM_FREQUENCY           1000  // PWM频率(Hz)
#define PWM_DUTY_LOW            50    // 低亮度
#define PWM_DUTY_MED            128   // 中亮度
#define PWM_DUTY_HIGH           200   // 高亮度
```

#### WS2812B配置
```c
#define WS2812B_LED_COUNT       90    // 灯珠数量
#define WS2812B_BRIGHTNESS_DAY  180   // 白天亮度
#define WS2812B_BRIGHTNESS_NIGHT 255  // 夜晚亮度
```

#### 灯珠分区配置
```c
#define WS2812B_ZONE_FRONT_LEFT  0      // 前左起始索引
#define WS2812B_ZONE_FRONT_LEFT_LEN 15  // 前左灯珠数
// ... 其他区域配置
```

#### 传感器阈值
```c
#define BATTERY_LOW_VOLTAGE     11.0f   // 低电压报警(V)
#define LIGHT_THRESHOLD_DAY     800    // 白天阈值(ADC)
#define LIGHT_THRESHOLD_NIGHT   300    // 夜晚阈值(ADC)
#define AUDIO_THRESHOLD         100    // 音频检测阈值
```

---

## 故障排除

### 常见问题

#### 1. 系统不启动
**现象：** 上电后无任何反应  
**可能原因：**
- 电源电压不足
- MCU未正常工作
- 程序未烧录

**解决方法：**
1. 检查电源电压（应为12V±10%）
2. 检查MCU复位引脚
3. 重新烧录程序

#### 2. WS2812B不亮或闪烁
**现象：** WS2812B灯珠不亮或随机闪烁  
**可能原因：**
- 数据线接触不良
- 时序不正确
- 电源不足

**解决方法：**
1. 检查P2.5数据线连接
2. 确认WS2812B电源5V稳定
3. 检查MCU主频设置（应为48MHz）
4. 添加数据线串联47Ω电阻

#### 3. 按键无响应
**现象：** 按下按键无反应  
**可能原因：**
- 按键未接上拉电阻
- 中断未使能
- 按键硬件故障

**解决方法：**
1. 检查按键硬件（应为下拉式按键）
2. 确认ENABLE_INT_KEY=1
3. 使用万用表测试按键通断

#### 4. 原车信号检测失败
**现象：** 踩刹车、打转向灯无反应  
**可能原因：**
- 信号线接错
- 信号电平不匹配
- 消抖时间设置不当

**解决方法：**
1. 用万用表测量原车信号电压
2. 检查P0口接线
3. 调整DEBOUNCE_TIME_MS参数
4. 查看UART调试输出信号状态

#### 5. RGB灯颜色不正确
**现象：** RGB灯颜色与预期不符  
**可能原因：**
- PWM占空比设置错误
- 电源电压不稳
- LED驱动电路问题

**解决方法：**
1. 检查P1.1/1.2/1.3输出
2. 测量PWM输出波形
3. 确认共阴还是共阳RGB

#### 6. 电池电压显示不准
**现象：** 显示电压与实际不符  
**可能原因：**
- 分压电阻值不对
- ADC参考电压不准
- 转换公式错误

**解决方法：**
1. 检查分压电路（R1=20K, R2=10K）
2. 修正app_sensors.c中的转换公式
3. 校准ADC参考电压

#### 7. 系统频繁重启
**现象：** 系统运行不稳定，经常重启  
**可能原因：**
- 看门狗超时
- 电源纹波过大
- 程序死循环

**解决方法：**
1. 检查看门狗喂狗位置
2. 增加电源滤波电容
3. 检查TaskMonitor报告

---

## 扩展功能

### 预留扩展接口

#### 1. 加速度传感器接口
**建议型号：** MPU6050 (I2C接口)  
**连接引脚：** P1.4(SDA), P1.5(SCL)  
**功能：** 检测急加速/急减速，触发特殊灯效

#### 2. CAN总线接口
**建议芯片：** MCP2515 (SPI接口)  
**连接引脚：** P1.1(CS), P1.2(SO), P1.3(SI), P1.4(SCK)  
**功能：** 读取原车CAN总线数据

#### 3. 蓝牙模块接口
**建议型号：** HC-05 (UART接口)  
**连接引脚：** P5.0(RX), P5.1(TX)  
**功能：** 手机APP控制灯光效果

### 功能增强建议

1. **GPS定位模块**
   - 记录行驶轨迹
   - 紧急情况自动发送位置

2. **OTA升级功能**
   - 通过WiFi/蓝牙升级固件
   - 支持云端配置下发

3. **语音控制**
   - 集成语音识别模块
   - 语音切换灯光效果

4. **手势控制**
   - 使用雷达传感器
   - 手势切换场景

---

## 性能指标

### 系统性能

| 指标项           | 数值        | 说明                    |
|-----------------|------------|------------------------|
| CPU占用率       | < 30%      | 正常运行时平均占用      |
| 任务响应时间    | < 50ms     | 从信号检测到灯光响应    |
| WS2812B刷新率   | 50Hz       | 20ms更新一次            |
| PWM刷新率       | 100Hz      | 10ms更新一次            |
| 按键响应时间    | < 30ms     | 包含消抖时间            |
| 系统启动时间    | < 500ms    | 从上电到正常运行        |

### 功耗分析

| 模式             | 电流       | 功耗(12V)  | 说明                    |
|-----------------|-----------|-----------|------------------------|
| 空闲模式         | ~50mA     | 0.6W      | 所有灯光关闭            |
| 位置灯模式       | ~500mA    | 6W        | 低亮度运行              |
| 全灯最大亮度     | ~3A       | 36W       | WS2812B+RGB全亮         |
| 刹车场景         | ~1.5A     | 18W       | 刹车灯+尾部区域高亮     |

**注意事项：**
- 建议使用3A以上的电源适配器
- 电源线应使用1.5mm²以上线径
- 安装保险丝（5A）保护电路

---

## 安全注意事项

### 电气安全

1. **电源要求：**
   - 输入电压：DC 12V (11V-14V)
   - 输入电流：最大3.5A
   - 必须使用带保险丝的电源线

2. **防水防尘：**
   - 控制器需安装在防水盒内
   - WS2812B灯条选用IP65防水等级
   - 所有接线接头做防水处理

3. **散热措施：**
   - 控制器留有散热孔
   - WS2812B灯条避免密闭安装
   - 环境温度 > 50℃时自动降低亮度

### 使用安全

1. **安装位置：**
   - 避免遮挡原车灯光
   - 不得影响车辆正常操作
   - 固定牢固，防止脱落

2. **驾驶注意：**
   - 测试模式请在静止时使用
   - 夜晚模式亮度过高可能影响他人
   - 关注系统状态LED，及时处理异常

3. **维护保养：**
   - 定期检查接线是否松动
   - 清理灰尘，保持散热
   - 雨天后检查防水情况

---

## 附录

### A. 文件清单

#### 头文件 (Sources/inc/)
```
moto_lights_config.h      - 系统配置参数
moto_lights_pinmap.h      - 引脚映射定义
app_moto_lights.h         - 主应用层接口
app_vehicle_signal.h      - 原车信号检测接口
app_ws2812b.h             - WS2812B控制接口
app_pwm_output.h          - PWM输出接口
app_light_scheduler.h     - 灯光调度器接口
app_sensors.h             - 传感器管理接口
```

#### 源文件 (Sources/src/)
```
app_moto_lights.c         - 主应用层实现
app_vehicle_signal.c      - 原车信号检测实现
app_ws2812b.c             - WS2812B控制实现
app_pwm_output.c          - PWM输出实现
app_light_scheduler.c     - 灯光调度器实现
app_sensors.c             - 传感器管理实现
System_init.c             - 系统初始化
Task.c                    - 任务调度
app.c                     - 应用配置
```

#### 中断服务程序 (Sources/isr/)
```
Timer_Isr.c               - 定时器中断服务
```

### B. 参考资料

1. **AI8051U数据手册**
   - 官网：www.stcai.com
   - 文档：AI8051U系列单片机数据手册

2. **WS2812B数据手册**
   - 制造商：Worldsemi
   - 时序要求：800kHz，GRB格式

3. **开发工具**
   - IDE：Keil uVision5
   - 烧录工具：STC-ISP
   - 调试工具：串口调试助手

4. **相关标准**
   - GB 7258-2017 机动车运行安全技术条件
   - GB 4785-2019 汽车及挂车外部照明和光信号装置的安装规定

### C. 版本历史

| 版本  | 日期       | 修改内容                          | 作者    |
|------|-----------|----------------------------------|---------|
| V1.0 | 2025-11-17| 初始版本发布                      | Sherwin.Chen |

### D. 联系方式

**技术支持：**
- 网站：www.stcai.com
- 论坛：www.stcaimcu.com/forum

**问题反馈：**
- 请通过GitHub Issues提交
- 或发送邮件至技术支持邮箱

---

## 结语

本系统设计遵循模块化、可扩展的原则，为摩托车提供了智能、安全、美观的灯光联动解决方案。通过优先级调度机制，确保了安全功能（如刹车灯）的最高优先级，同时提供了丰富的灯光效果和用户交互功能。

系统采用事件驱动架构，各模块职责清晰，便于维护和扩展。预留的接口支持后续功能增强，如加速度传感器、CAN总线、蓝牙控制等。

希望本设计文档能够帮助您快速理解和使用本系统。如有任何问题或建议，欢迎反馈！

---

**文档版本：** V1.0  
**最后更新：** 2025-11-17  
**文档状态：** 正式发布

