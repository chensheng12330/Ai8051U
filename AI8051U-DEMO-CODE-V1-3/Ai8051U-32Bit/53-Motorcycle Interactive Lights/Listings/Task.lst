C251 COMPILER V5.60.0,  Task                                                               10/11/25  23:48:08  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE Task
OBJECT MODULE PLACED IN .\Objects\Task.obj
COMPILER INVOKED BY: C:\Keil_v5\C251\BIN\C251.EXE Sources\src\Task.c XSMALL INTR2 BROWSE INCDIR(.\Sources\inc) DEBUG PRI
                    -NT(.\Listings\Task.lst) TABS(2) OBJECT(.\Objects\Task.obj) 

stmt  level    source

    1          /*---------------------------------------------------------------------*/
    2          /* --- Web: www.STCAI.com ---------------------------------------------*/
    3          /*---------------------------------------------------------------------*/
    4          
    5          #include "Task.h"
    6          #include "app.h"
    7          
    8          //========================================================================
    9          // 集成独立监控插件（可选，需要时才包含）
   10          //========================================================================
   11          #include "TaskMonitor/TaskMonitor.h"   // 任务性能监控插件
   12          #include "CPUMonitor/CPUMonitor.h"     // CPU占用率监控插件
   13          
   14          //========================================================================
   15          //                               本地变量声明
   16          //========================================================================
   17          
   18          static TASK_COMPONENTS Task_Comps[]=
   19          {
   20          //状态  计数  周期  函数
   21              {0, 1,   1,   Sample_Display},              /* task 1 Period： 1ms */
   22              {0, 10,  10,  Sample_MatrixKey},            /* task 2 Period： 10ms */
   23              {0, 10,  10,  Sample_adcKey},               /* task 3 Period： 10ms */
   24              {0, 300, 300, Sample_NTC},                  /* task 4 Period： 300ms */
   25              {0, 500, 500, Sample_RTC},                  /* task 5 Period： 500ms */
   26          #if ENABLE_INT_KEY
   27              {0, 10,  10,  Sample_intKey},               /* task 6 Period： 10ms - 外部中断按键 */
   28          #endif
   29              //========================================================================
   30              // 摩托车智能灯组系统任务 (新增)
   31              //========================================================================
   32              {0, 1,   1,   Sample_Vehicle_Signal_Process},   /* task 7 Period： 1ms - 原车信号处理 */
   33              {0, 2,   2,   Sample_WS2812_DMA_Control},       /* task 8 Period： 2ms - WS2812 DMA控制 */
   34              {0, 5,   5,   Sample_Button_Process},           /* task 9 Period： 5ms - 按键处理 */
   35              {0, 10,  10,  Sample_Sensor_Read},              /* task 10 Period： 10ms - 传感器读取 */
   36              {0, 20,  20,  Sample_Light_Effect_Calculate},   /* task 11 Period： 20ms - 灯效算法 */
   37              {0, 50,  50,  Sample_Audio_Process},            /* task 12 Period： 50ms - 音频处理 */
   38              {0, 100, 100, Sample_Status_Display},           /* task 13 Period： 100ms - 状态指示 */
   39              {0, 500, 500, Sample_Debug_Output},             /* task 14 Period： 500ms - 调试输出 */
   40          
   41              //========================================================================
   42              // 系统状态机任务 (新增)
   43              //========================================================================
   44              {0, 100, 100, System_State_Machine},            /* task 15 Period： 100ms - 系统状态机 */
   45          
   46              //========================================================================
   47              // 监控插件任务（可选）
   48              //========================================================================
   49              {0, 1000,1000,CPUMonitor_Calculate},            /* CPU监控：每秒计算占用率 */
   50              {0, 5000,5000,TaskMonitor_PrintReport},         /* 任务监控：每5秒打印报告 */
   51              {0, 5000,5000,CPUMonitor_PrintReport},          /* CPU监控：每5秒打印报告 */
   52          
   53              //========================================================================
   54              // USB HID 调试任务
   55              //========================================================================
   56              {0, 1,   1,   Sample_USB_Debug},                /* USB调试：每1ms执行一次 */
   57          
   58              /* Add new task here */
C251 COMPILER V5.60.0,  Task                                                               10/11/25  23:48:08  PAGE 2   

   59          };
   60          
   61          u8 Tasks_Max = sizeof(Task_Comps)/sizeof(Task_Comps[0]);
   62          
   63          //========================================================================
   64          // 函数: Task_Handler_Callback
   65          // 描述: 任务标记回调函数.
   66          // 参数: None.
   67          // 返回: None.
   68          // 版本: V1.0, 2012-10-22
   69          //========================================================================
   70          void Task_Marks_Handler_Callback(void)
   71          {
   72   1          u8 i;
   73   1          for(i=0; i<Tasks_Max; i++)
   74   1          {
   75   2              if(Task_Comps[i].TIMCount)      /* If the time is not 0 */
   76   2              {
   77   3                  Task_Comps[i].TIMCount--;   /* Time counter decrement */
   78   3                  if(Task_Comps[i].TIMCount == 0) /* If time arrives */
   79   3                  {
   80   4                      /*Resume the timer value and try again */
   81   4                      Task_Comps[i].TIMCount = Task_Comps[i].TRITime;  
   82   4                      Task_Comps[i].Run = 1;      /* The task can be run */
   83   4                  }
   84   3              }
   85   2          }
   86   1      }
   87          
   88          //========================================================================
   89          // 函数: Task_Pro_Handler_Callback
   90          // 描述: 任务处理回调函数.
   91          // 参数: None.
   92          // 返回: None.
   93          // 版本: V1.0, 2012-10-22
   94          //========================================================================
   95          void Task_Pro_Handler_Callback(void)
   96          {
   97   1          u8 i;
   98   1          for(i=0; i<Tasks_Max; i++)
   99   1          {
  100   2              if(Task_Comps[i].Run) /* If task can be run */
  101   2              {
  102   3                  //================================================================
  103   3                  // 优化4：TaskMonitor插件钩子 - 任务开始
  104   3                  //================================================================
  105   3                  TASK_MONITOR_START(i);
  106   3                  
  107   3                  Task_Comps[i].Run = 0;      /* Flag clear 0 */
  108   3                  Task_Comps[i].TaskHook();   /* Run task */
  109   3                  
  110   3                  //================================================================
  111   3                  // 优化4：TaskMonitor插件钩子 - 任务结束
  112   3                  //================================================================
  113   3                  TASK_MONITOR_END(i);
  114   3              }
  115   2          }
  116   1      }


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       116     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
C251 COMPILER V5.60.0,  Task                                                               10/11/25  23:48:08  PAGE 3   

  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =       134     ------
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =       142     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
