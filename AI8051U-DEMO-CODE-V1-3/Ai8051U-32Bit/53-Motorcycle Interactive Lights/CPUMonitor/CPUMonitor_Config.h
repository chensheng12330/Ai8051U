#ifndef __CPU_MONITOR_CONFIG_H_
#define __CPU_MONITOR_CONFIG_H_

/*============================================================================*/
/*                    CPU占用率监控插件 - 配置文件                            */
/*============================================================================*/

//========================================================================
//                          启用/禁用配置
//========================================================================

// CPU监控总开关
#define CPU_MONITOR_ENABLE  1  // 1=启用, 0=禁用

// 如果禁用:
//   - 所有CPU监控代码不编译
//   - 宏定义为空操作
//   - Flash占用: 0字节
//   - CPU开销: 0%

//========================================================================
//                          系统频率配置
//========================================================================

#ifndef MAIN_Fosc
    #define MAIN_Fosc  48000000L  // 默认48MHz，需与项目Config.h一致
#endif

//========================================================================
//                          计算方式配置
//========================================================================

// CPU占用率计算方式
#define CPU_CALC_METHOD_IDLE_COUNT  1  // 基于空闲计数（推荐）
#define CPU_CALC_METHOD_BUSY_TIME   2  // 基于忙时间（精确但开销大）

#define CPU_MONITOR_CALC_METHOD  CPU_CALC_METHOD_IDLE_COUNT  // 当前使用

//========================================================================
//                          采样周期配置
//========================================================================

// 计算周期（多久计算一次CPU占用率）
#define CPU_MONITOR_SAMPLE_PERIOD_MS  1000  // 1000ms = 1秒

// 基准空闲计数（不同频率下需要校准）
// 这是空闲状态下每秒的循环次数
#if (MAIN_Fosc == 24000000L)
    #define CPU_MONITOR_IDLE_LOOPS_PER_SEC  1000000L  // 24MHz时约100万次/秒
#elif (MAIN_Fosc == 48000000L)
    #define CPU_MONITOR_IDLE_LOOPS_PER_SEC  2000000L  // 48MHz时约200万次/秒
#elif (MAIN_Fosc == 72000000L)
    #define CPU_MONITOR_IDLE_LOOPS_PER_SEC  3000000L  // 72MHz时约300万次/秒
#elif (MAIN_Fosc == 96000000L)
    #define CPU_MONITOR_IDLE_LOOPS_PER_SEC  4000000L  // 96MHz时约400万次/秒
#else
    #define CPU_MONITOR_IDLE_LOOPS_PER_SEC  2000000L  // 默认按48MHz
#endif

//========================================================================
//                          调试输出配置
//========================================================================

// 是否启用调试输出
#define CPU_MONITOR_DEBUG  0  // 0=关闭, 1=启用

// 串口输出函数
#ifndef CPU_MONITOR_PRINTF
    #include <stdio.h>
    #define CPU_MONITOR_PRINTF  printf
#endif

//========================================================================
//                          高级配置
//========================================================================

// 历史数据记录
#define CPU_MONITOR_KEEP_HISTORY  1  // 是否记录历史最大/最小值

// 自动校准（首次运行时自动校准空闲基准）
#define CPU_MONITOR_AUTO_CALIBRATE  1  // 1=自动校准, 0=使用预设值

// 滤波器（平滑CPU占用率波动）
#define CPU_MONITOR_USE_FILTER  1  // 1=使用滤波, 0=直接显示
#define CPU_MONITOR_FILTER_ALPHA  70  // 滤波系数(0-100), 70表示新值权重70%

//========================================================================
//                          兼容性配置
//========================================================================

#define _TYPE_DEF_DEFINED_  1  // 标记类型已定义

#endif /* __CPU_MONITOR_CONFIG_H_ */

