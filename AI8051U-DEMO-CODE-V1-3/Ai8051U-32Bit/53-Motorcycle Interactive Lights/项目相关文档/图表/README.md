# 📊 AI8051U 任务调度系统 - 可视化图表

本目录包含任务调度系统的所有可视化图表（Draw.io格式），可以直接在 [Draw.io](https://app.diagrams.net/) 或 [diagrams.net](https://www.diagrams.net/) 中打开编辑。

> **✅ 最新优化：** 所有图表文字已优化为**黑色加粗**，字号增大15-30%，可读性大幅提升！  
> **详见：** `✅_图表优化完成说明.md`

---

## 📁 文件列表

| 文件名 | 类型 | 说明 | 文字优化 |
|--------|------|------|---------|
| `1-主程序执行流程图.drawio` | 流程图 | 系统启动到主循环的完整执行流程 | ✅ 黑色加粗 |
| `2-任务调度时序图.drawio` | 时序图 | 5个任务的调度时序关系 | ✅ 黑色加粗 |
| `3-中断与主循环交互序列图.drawio` | 序列图 | Timer0中断与主循环的交互过程 | ✅ 黑色加粗 |
| `4-系统分层架构图.drawio` | 架构图 | 应用层→调度层→HAL层→硬件层 | ✅ 黑色加粗 |
| `✅_图表优化完成说明.md` | 说明 | 文字优化详情和对比 | 📖 必读 |
| `README.md` (本文件) | 索引 | 使用说明和指南 | 📖 索引 |

---

## 🚀 如何使用

### 方法1：在线编辑

1. 访问 https://app.diagrams.net/
2. 选择 `打开现有图表` (Open Existing Diagram)
3. 选择本地文件，打开对应的 `.drawio` 文件
4. 编辑后可导出为 PNG、SVG、PDF 等格式

### 方法2：VS Code 编辑

1. 安装 Draw.io Integration 插件
   ```
   名称: Draw.io Integration
   发布者: Henning Dieterichs
   ```

2. 直接在 VS Code 中双击 `.drawio` 文件即可编辑

### 方法3：导出为图片

在 Draw.io 中打开文件后：
- `文件` → `导出为` → `PNG/SVG/PDF`
- 推荐设置：
  - PNG: 300 DPI, 透明背景
  - SVG: 矢量格式，适合缩放
  - PDF: 适合打印

---

## 📋 图表详细说明

### 1. 主程序执行流程图

**内容：**
- 系统启动流程
- 硬件初始化步骤
- SYS_Init() 详细展开
- 主循环结构
- Timer0中断与主循环的关系

**适用场景：**
- 新人了解程序执行流程
- 调试初始化问题
- 系统架构讲解

**关键元素：**
- 绿色：启动阶段
- 黄色：硬件初始化
- 蓝色：SYS_Init
- 紫色：外设配置
- 红色：主循环
- 灰色：中断处理

---

### 2. 任务调度时序图

**内容：**
- 时间轴（0-20ms）
- 5个任务的执行时序
- Timer0中断触发点
- 任务执行时间占比

**适用场景：**
- 理解任务调度周期
- 分析任务执行冲突
- 优化任务周期设置

**关键元素：**
- ▼ 中断触发点
- 彩色块：不同任务执行
- 图例：任务周期说明
- 性能指标框

---

### 3. 中断与主循环交互序列图

**内容：**
- Timer0中断生命线
- 主循环生命线
- 任务标记过程
- 任务执行过程
- 时间轴标注

**适用场景：**
- 理解中断驱动机制
- 调试任务漏执行问题
- 分析响应延迟

**关键元素：**
- 红色：Timer0中断
- 绿色：主循环
- 黄色：Task_Marks_Handler
- 蓝色：Task_Pro_Handler
- 时间线：性能分析

---

### 4. 系统分层架构图

**内容：**
- 应用层（5个任务模块）
- 任务调度层（TCB、Handler）
- 硬件抽象层（GPIO、Timer、ADC等）
- 硬件层（AI8051U MCU）

**适用场景：**
- 系统整体架构理解
- 代码模块化设计
- 新功能扩展规划

**关键元素：**
- 蓝色：应用层
- 黄色：调度层
- 紫色：HAL层
- 红色：硬件层
- 箭头：数据流向

---

## 🎨 配色方案

所有图表使用统一的配色方案：

| 颜色 | 用途 | 色值 |
|------|------|------|
| 🟢 绿色 | 正常流程、成功状态 | #d5e8d4 |
| 🔵 蓝色 | 系统功能、配置 | #dae8fc |
| 🟡 黄色 | 调度相关、重要信息 | #fff2cc |
| 🟣 紫色 | 硬件抽象层 | #e1d5e7 |
| 🔴 红色 | 中断、主循环 | #f8cecc |
| ⚪ 灰色 | 硬件层、通用组件 | #f5f5f5 |
| 🟠 橙色 | 性能指标、警告 | #ffe6cc |

---

## 📐 图表规范

### 流程图符号

- **圆角矩形** - 开始/结束
- **矩形** - 处理步骤
- **菱形** - 判断分支
- **箭头** - 流程方向
- **虚线箭头** - 子流程调用

### 时序图规范

- **生命线** - 竖直虚线
- **激活框** - 实心矩形条
- **消息** - 实线箭头（调用）
- **返回** - 虚线箭头（返回）

---

## 🔧 自定义修改指南

### 添加新任务到时序图

1. 复制现有任务的执行块
2. 修改任务名称和周期
3. 调整执行时间位置
4. 更新图例说明

### 修改系统架构

1. 在对应层添加新模块
2. 绘制连接箭头
3. 更新说明文字
4. 调整布局对齐

### 导出高质量图片

**PNG导出设置：**
```
分辨率: 300 DPI
缩放: 100%
边框: 10px
背景: 透明/白色
```

**SVG导出设置：**
```
嵌入字体: 是
包含拷贝: 否
```

---

## 📚 相关文档

- `../系统架构分析.md` - 详细的文字说明
- `../性能风险评估报告.md` - 性能分析
- `../快速集成指南.md` - 实战教程

---

## ✏️ 编辑建议

### 使用 Draw.io 的最佳实践

1. **网格对齐** - 启用网格（10px），使用对齐工具
2. **统一字体** - 使用 Arial 或系统默认字体
3. **颜色一致** - 使用配色方案中的颜色
4. **图层管理** - 复杂图表使用图层分组
5. **导出前检查** - 确保所有文字清晰可读

### 常用快捷键

| 快捷键 | 功能 |
|--------|------|
| `Ctrl + D` | 复制选中元素 |
| `Ctrl + G` | 组合元素 |
| `Ctrl + Shift + G` | 取消组合 |
| `Ctrl + Z` | 撤销 |
| `Ctrl + Shift + Z` | 重做 |
| `Delete` | 删除选中元素 |
| `Ctrl + Mouse Wheel` | 缩放 |

---

## 🆘 常见问题

### Q: 文字显示为乱码？

**A:** Draw.io 默认使用 Unicode 编码，确保：
- 使用标准字体（Arial、Microsoft YaHei）
- 导出 PNG 时选择"嵌入字体"

### Q: 导出的图片太大？

**A:** 调整导出设置：
- 降低 DPI（200-300即可）
- 缩小边框（5-10px）
- 使用 SVG 格式（矢量图，文件小）

### Q: 如何批量导出所有图表？

**A:** 使用命令行工具：
```bash
# 安装 draw.io desktop 后
drawio -x -f png -o output/ *.drawio
```

---

## 📊 统计信息

| 图表 | 元素数量 | 复杂度 | 建议编辑时间 |
|------|---------|--------|-------------|
| 主程序执行流程图 | 25+ | 中等 | 30分钟 |
| 任务调度时序图 | 30+ | 中等 | 40分钟 |
| 中断交互序列图 | 20+ | 简单 | 20分钟 |
| 系统分层架构图 | 35+ | 复杂 | 50分钟 |

---

## 🎯 使用建议

### 学习阶段

1. **先看流程图** - 了解程序执行顺序
2. **再看时序图** - 理解任务调度机制
3. **最后看架构图** - 掌握系统整体结构

### 开发阶段

1. **参考架构图** - 规划新功能模块位置
2. **查看时序图** - 确定任务周期设置
3. **修改流程图** - 添加新的初始化步骤

### 调试阶段

1. **对照序列图** - 分析中断和任务执行关系
2. **检查时序图** - 排查任务冲突问题

---

**更新日期：** 2025-10-21  
**版本：** v1.0  
**作者：** AI Technical Analyst  
**文档状态：** ✅ 完整可用

