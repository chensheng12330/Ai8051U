# AI8051U 示例代码详细清单

本文档提供所有87个示例的完整列表和详细功能说明。

---

## 示例总览表格

| 序号 | 目录名称 | 功能描述 | 语言 | 时钟 | 难度 | 推荐 |
|------|---------|---------|------|------|------|------|
| 01 | 用P0口做跑马灯 | GPIO基础，8个LED依次点亮 | C+ASM | 24MHz | ⭐ | ✓ |
| 02 | Timer0-Timer1-Timer2-Timer3-Timer4测试程序 | 5个定时器16位自动重装，输出不同频率方波 | C+ASM | 24MHz | ⭐⭐ |  |
| 03.1 | 通过IO口控制74HC595驱动8个共阴极数码管 | 软件SPI驱动数码管，显示数码时钟 | C+ASM | 24MHz | ⭐⭐ |  |
| 03.2 | 通过硬件SPI控制74HC595驱动8个共阴极数码管 | 硬件SPI驱动数码管，显示数码时钟 | C+ASM | 24MHz | ⭐⭐ |  |
| 04 | 利用T0,T1引脚做外部计数器 | 定时器计数模式，统计外部脉冲 | C+ASM | 24MHz | ⭐⭐ |  |
| 05 | 利用定时器1测量INT1引脚低电平脉冲宽度 | 脉冲宽度测量，捕获模式 | C+ASM | 24MHz | ⭐⭐ |  |
| 06 | 主时钟停振低功耗模式-专用唤醒定时器唤醒 | 低功耗休眠，定时器自动唤醒 | C+ASM | 24MHz | ⭐⭐⭐ |  |
| 07 | 主时钟停振低功耗模式-外部中断INT0-INT4唤醒 | 低功耗休眠，外部中断唤醒 | C+ASM | 24MHz | ⭐⭐⭐ |  |
| 08 | 看门狗复位测试程序 | 看门狗定时器应用，超时复位 | C+ASM | 24MHz | ⭐⭐ |  |
| 09 | 软件设置CPU工作的内部时钟源-HIRC-PLL-IRC32K | 动态切换时钟源，HIRC/PLL/IRC32K | C+ASM | 多种 | ⭐⭐⭐ |  |
| 10 | 串口1中断模式与电脑收发测试 | UART1全双工通信，回显测试 | C+ASM | 22.1184MHz | ⭐⭐ | ✓ |
| 11 | 串口2中断模式与电脑收发测试 | UART2全双工通信 | C+ASM | 22.1184MHz | ⭐⭐ |  |
| 12 | 串口3中断模式与电脑收发测试，需飞线 | UART3全双工通信 | C+ASM | 22.1184MHz | ⭐⭐ |  |
| 13 | 串口4中断模式与电脑收发测试，需飞线 | UART4全双工通信 | C+ASM | 22.1184MHz | ⭐⭐ |  |
| 14.1 | 串口1串口2中断模式同时与电脑收发测试 | 双串口同时工作 | C+ASM | 22.1184MHz | ⭐⭐⭐ |  |
| 14.2 | 串口1与串口2通信测试程序 | 串口之间互联通信 | C | 22.1184MHz | ⭐⭐ |  |
| 14.3 | 外中断INT0-INT1-INT2-INT3-INT4测试-串口打印中断计数 | 5个外部中断测试 | C+ASM | 24MHz | ⭐⭐ |  |
| 15 | IO行列扫描按键，数码管显示键值，按键调整数码管显示内容 | 4x4矩阵键盘+数码管，时钟调整 | C+ASM | 24MHz | ⭐⭐⭐ | ✓ |
| 16 | ADC检测16个按键，数码管显示键值，按键调整数码管显示内容 | ADC电阻分压按键识别+数码管 | C+ASM | 24MHz | ⭐⭐⭐ |  |
| 17 | ADC采集NTC热敏电阻测温度，数码管显示 | NTC温度测量，0.1度分辨率 | C+ASM | 24MHz | ⭐⭐⭐ |  |
| 18 | P1.3做ADC3-使用ADC15测量内部1.19V信号源，计算外部电压VCC | 内部基准测VCC电压 | C+ASM | 24MHz | ⭐⭐⭐ |  |
| 19 | 通过串口发送命令读写EEPROM测试程序 | 串口命令控制EEPROM读写 | C+ASM | 22.1184MHz | ⭐⭐⭐ | ✓ |
| 20 | 使用LVD低压检测VCC中断保存EEPROM，反应时间太短建议使用比较器检测稳压管输入端 | LVD低压检测，掉电保护 | C+ASM | 24MHz | ⭐⭐⭐⭐ |  |
| 21 | 利用P4.6做比较器正极输入源，内部1.19V做负极输入源 | 模拟比较器应用 | C+ASM | 24MHz | ⭐⭐⭐ |  |
| 22 | 使用比较器检测外部稳压管输入前端，掉电时及时保存数据到EEPROM | 比较器掉电检测（推荐方案） | C+ASM | 24MHz | ⭐⭐⭐⭐ |  |
| 23 | PCA型PWM输出呼吸灯效果 | PCA-PWM 4通道呼吸灯 | C+ASM | 24MHz | ⭐⭐ |  |
| 24 | 高级PWM1-PWM2-PWM3-PWM4，驱动P0口呼吸灯实验程序 | 高级PWM 8通道，P0口LED呼吸灯 | C+ASM | 24MHz | ⭐⭐⭐ |  |
| 25 | 高级PWM5-PWM6-PWM7-PWM8输出呼吸灯效果测试程序 | 高级PWM 5-8通道 | C+ASM | 24MHz | ⭐⭐⭐ |  |
| 26 | 通过PWM驱动无源蜂鸣器实验程序 | PWM音频输出，驱动蜂鸣器 | C+ASM | 24MHz | ⭐⭐ |  |
| 27 | 通过定时器周期性调度任务综合例程，简单实用的任务调度系统，推荐 | 多任务调度框架，时钟+温度+按键+显示 | C | 24MHz | ⭐⭐⭐⭐ | ✓✓✓ |
| 28 | I2C主机模式访问AT24C02程序 | 硬件I2C读写AT24C02 | C+ASM | 24MHz | ⭐⭐⭐ | ✓ |
| 29 | 红外遥控信号(NEC码)定时器0中断接收程序-串口打印用户码和键值 | NEC红外接收，串口打印 | C+ASM | 24MHz | ⭐⭐⭐⭐ |  |
| 30 | 红外发射程序(NEC码)-使用PWM4产生38KHz载波 | NEC红外发射，38kHz载波 | C+ASM | 24MHz | ⭐⭐⭐⭐ |  |
| 31 | IO行列式按键扫描，按键命令红外发射-同时接收，串口打印用户码和键值程序 | 红外收发综合应用 | C+ASM | 24MHz | ⭐⭐⭐⭐ |  |
| 32 | 硬件SPI访问FLASH-串口监控 | 硬件SPI+Flash，串口命令控制 | C | 22.1184MHz | ⭐⭐⭐ | ✓ |
| 33 | IO模拟SPI访问FLASH-串口监控 | 软件SPI+Flash | C | 22.1184MHz | ⭐⭐⭐ |  |
| 34 | 硬件QSPI访问FLASH-串口监控 | QSPI 4线高速访问Flash | C | 22.1184MHz | ⭐⭐⭐⭐ |  |
| 35 | 板载焊接的外部扩展32K xdata测试程序 | 外部32K SRAM扩展 | C | 24MHz | ⭐⭐⭐ |  |
| 36.1 | LCD1602显示程序-IO口模拟M6800并行接口 | LCD1602字符屏（软件驱动） | C | 24MHz | ⭐⭐ |  |
| 36.2 | LCD1602显示程序-硬件M6800并行接口驱动 | LCD1602字符屏（硬件驱动） | C | 24MHz | ⭐⭐ |  |
| 36.3 | LCD1602显示程序-硬件M6800并行接口+DMA刷新 | LCD1602+DMA自动刷新 | C | 24MHz | ⭐⭐⭐ |  |
| 36.4 | LCD128x64显示图形文字-ST7920-IO口模拟M6800并行接口 | LCD12864图形屏（ST7920） | C | 24MHz | ⭐⭐⭐ |  |
| 37.1 | 2.4寸ILI9341驱动TFT显示屏实验程序-带触摸功能，IO模拟I8080接口程序 | ILI9341 TFT 240x320+触摸（软件） | C | 24MHz | ⭐⭐⭐⭐ |  |
| 37.2 | 2.4寸ILI9341驱动TFT显示屏实验程序-带触摸功能，硬件I8080接口程序 | ILI9341 TFT 240x320+触摸（硬件） | C | 24MHz | ⭐⭐⭐⭐ |  |
| 37.3 | 2.4寸TFT320240彩屏，ILI9325驱动IC，IO模拟I8080接口程序 | ILI9325 TFT 320x240（软件） | C | 24MHz | ⭐⭐⭐⭐ |  |
| 37.4 | 2.4寸TFT320240彩屏，ILI9325驱动IC，硬件I8080接口程序 | ILI9325 TFT 320x240（硬件） | C | 24MHz | ⭐⭐⭐⭐ |  |
| 38 | 3.5寸ILI9486驱动TFT显示屏实验程序 | ILI9486 TFT 320x480大屏 | C | 24MHz | ⭐⭐⭐⭐ |  |
| 39 | 一线制温度传感器 DS18B20 测温-IO模拟 | DS18B20数字温度传感器 | C+ASM | 24MHz | ⭐⭐⭐ |  |
| 41 | 内部RTC时钟程序-使用外部32768晶振，才能保证RTC精度 | 硬件RTC实时时钟 | C+ASM | 24MHz+32768Hz | ⭐⭐⭐ |  |
| 42 | USB-HID(Human Interface Device)协议范例 | USB HID基础 | C | 24MHz | ⭐⭐⭐⭐ | ✓ |
| 43 | USB-CDC(Communication Device Class)协议范例 | USB虚拟串口 | C | 24MHz | ⭐⭐⭐⭐ | ✓ |
| 44 | 基于USB-HID协议的USB键盘范例 | USB键盘模拟 | C | 24MHz | ⭐⭐⭐⭐ |  |
| 45 | 基于USB-HID协议的USB鼠标范例 | USB鼠标模拟 | C | 24MHz | ⭐⭐⭐⭐ |  |
| 46 | 基于WINUSB协议的范例 | WINUSB协议 | C | 24MHz | ⭐⭐⭐⭐ |  |
| 47 | MSC(Mass Storage Class)协议范例-U盘演示程序 | USB U盘（1M容量） | C | 24MHz | ⭐⭐⭐⭐⭐ |  |
| 48 | 通过USB-HID发送命令读取ADC测试程序 | USB HID控制ADC采集 | C | 24MHz | ⭐⭐⭐⭐ |  |
| 49 | 通过USB HID协议打印数据信息-可用于调试 | USB HID调试输出 | C | 24MHz | ⭐⭐⭐ |  |
| 50 | ISP调试接口通过USB CDC协议驱动虚拟设备，如虚拟键盘，虚拟OLED12864等 | USB CDC虚拟设备驱动 | C | 24MHz | ⭐⭐⭐⭐ |  |
| 51 | USB-CDC转双串口-根据串口波特率选择出厂时校准的几种常用时钟频率做主频 | USB CDC双串口转换器 | C | 自适应 | ⭐⭐⭐⭐⭐ |  |
| 52 | USB鼠标-键盘复合设备例程 | USB复合设备（键盘+鼠标） | C | 24MHz | ⭐⭐⭐⭐⭐ |  |
| 56 | LIN总线从机收发测试-USART1 | LIN从机（USART1） | C | 24MHz | ⭐⭐⭐⭐ |  |
| 57 | LIN总线主机收发测试-USART1 | LIN主机（USART1） | C | 24MHz | ⭐⭐⭐⭐ |  |
| 58 | LIN总线从机收发测试-USART2 | LIN从机（USART2） | C | 24MHz | ⭐⭐⭐⭐ |  |
| 59 | LIN总线主机收发测试-USART2 | LIN主机（USART2） | C | 24MHz | ⭐⭐⭐⭐ |  |
| 60 | DMA-ADC采样数据自动存储 | DMA+ADC高速采样（3个子示例） | C | 22.1184MHz | ⭐⭐⭐⭐ | ✓ |
| 61 | DMA-M2M存储器与存储器之间读写 | DMA内存拷贝 | C | 24MHz | ⭐⭐⭐ |  |
| 62 | DMA-SPI与存储器数据自动收发 | DMA+SPI自动传输 | C | 24MHz | ⭐⭐⭐⭐ |  |
| 63 | DMA-QSPI-P2P访问QSPI Flash | DMA QSPI P2P传输 | C | 24MHz | ⭐⭐⭐⭐⭐ |  |
| 64 | DMA-UART串口与存储器数据自动收发 | DMA+UART自动收发（5个子示例） | C | 24MHz | ⭐⭐⭐⭐ |  |
| 65 | DMA-LCD12864-M6800接口，TFT320240-I8080接口，液晶屏测试 | DMA自动刷新LCD/TFT | C | 24MHz | ⭐⭐⭐⭐ |  |
| 66 | DMA-I2C主机模式读写AT24C02-串口监控 | DMA+I2C高速传输 | C | 24MHz | ⭐⭐⭐⭐ |  |
| 67 | 硬件高速HS-SPI访问FLASH-串口监控 | HS-SPI高速访问Flash | C | 22.1184MHz | ⭐⭐⭐⭐ |  |
| 68 | 高速HS-PWM1-HS-PWM2-HS-PWM3-HS-PWM4，驱动P0口呼吸灯实验程序 | HS-PWM高速输出 | C | 24MHz | ⭐⭐⭐ |  |
| 69 | USART1作为SPI_使用DMA和寄存器方式访问Flash例程 | USART-SPI模式+DMA | C | 24MHz | ⭐⭐⭐⭐ |  |
| 70 | USART1作为SPI与USART2作为SPI相互通信例程 | 双USART-SPI通信 | C | 24MHz | ⭐⭐⭐⭐ |  |
| 71.1 | 电脑通过UART发送图片数据写入到DMA SPI Flash，SPI-TFT_DMA_双缓冲区交替显示图片，不占CPU时间程序-ILI9341 | UART→Flash→TFT图片显示（ILI9341） | C | 24MHz | ⭐⭐⭐⭐⭐ |  |
| 71.2 | 电脑通过UART发送图片数据写入到DMA SPI Flash，SPI-TFT_DMA_双缓冲区交替显示图片，不占CPU时间程序-ILI9325 | UART→Flash→TFT图片显示（ILI9325） | C | 24MHz | ⭐⭐⭐⭐⭐ |  |
| 72.1 | UART-SPI-TFT_DMA_P2P外设到外设_显示图片程序 | UART-SPI-TFT P2P显示 | C | 24MHz | ⭐⭐⭐⭐⭐ |  |
| 72.2 | QSPI-TFT_DMA_P2P外设到外设_显示图片程序 | QSPI-TFT P2P显示图片 | C | 24MHz | ⭐⭐⭐⭐⭐ |  |
| 72.3 | QSPI-TFT_DMA_P2P外设到外设_显示视频级动画效果程序-ILI9325 | QSPI-TFT P2P视频级动画（ILI9325） | C | 24MHz | ⭐⭐⭐⭐⭐ | ✓✓ |
| 72.4 | QSPI-TFT_DMA_P2P外设到外设_显示视频级动画效果程序-ILI9341 | QSPI-TFT P2P视频级动画（ILI9341） | C | 24MHz | ⭐⭐⭐⭐⭐ | ✓✓ |
| 73 | 频谱分析256点FFT-USB-CDC送电脑ISP软件调试接口FFT绘图显示 | 256点FFT频谱分析 | C | 24MHz | ⭐⭐⭐⭐⭐ | ✓ |
| 74 | USB声卡-TLV320AIC23B-内部36.864MHz-用外部32768Hz晶振自动追频调节内部时钟 | USB声卡+I2S+自动追频 | C | 36.864MHz | ⭐⭐⭐⭐⭐ |  |
| 75 | 并口LCD128x64显示图形文字-ST7920-用DMA-M6800接口自动刷新 | LCD12864 DMA刷新 | C | 24MHz | ⭐⭐⭐⭐ |  |
| 76 | ST7789驱动1.3寸TFT240x240显示屏实验程序-SPI-DMA刷屏 | ST7789 TFT SPI+DMA | C | 24MHz | ⭐⭐⭐⭐ |  |
| 77 | DMA SPI刷新OLED12864显示屏程序，SSD1306驱动，0.96寸 | OLED SPI+DMA | C | 24MHz | ⭐⭐⭐ |  |
| 78 | DMA SPI刷新LCD12864显示屏程序，ST7565R驱动，1.44寸 | LCD12864 SPI+DMA（ST7565R） | C | 24MHz | ⭐⭐⭐⭐ |  |
| 79 | 使用TFT彩屏8位数据口接R-2R电阻做DAC通过DMA输出波形 | TFT数据口做DAC | C | 24MHz | ⭐⭐⭐⭐ |  |
| 80 | SPI-DMA发送-驱动WS2812彩灯 | WS2812智能LED驱动 | C | 25.6MHz | ⭐⭐⭐⭐ | ✓ |
| 81 | I2S-播放下载在FLASH中的立体声ADPCM音乐-TLV320AIC23B | I2S播放ADPCM音乐 | C | 36.864MHz | ⭐⭐⭐⭐⭐ |  |
| 82 | I2S接口-数字录放音-存储在FLASH中-TLV320AIC23B | I2S录放音 | C | 36.864MHz | ⭐⭐⭐⭐⭐ |  |
| 83 | 高级PWM硬件移相 | PWM硬件移相功能 | C | 24MHz | ⭐⭐⭐⭐ |  |
| 84 | USB录放音声卡-TLV320AIC23B-内部36.864M-外接32768Hz晶振 | USB全双工声卡 | C | 36.864MHz | ⭐⭐⭐⭐⭐ |  |
| 85 | 示波器-CDC虚拟显示 | USB虚拟示波器 | C | 24MHz | ⭐⭐⭐⭐⭐ | ✓ |
| 86 | 普通IO口中断-休眠唤醒 | GPIO中断唤醒 | C+ASM | 24MHz | ⭐⭐⭐ |  |
| 87 | U8G2_DMA_OLED | U8G2图形库+OLED+DMA | C | 24MHz | ⭐⭐⭐⭐ |  |
| A01 | 如发现P32按键接地用户程序就软复位到系统区不停电下载 | 按键触发ISP下载 | C | 24MHz | ⭐⭐⭐ |  |
| A02 | 电脑端的ISP软件通过USB-CDC发送命令通知MCU软复位到系统区不停电下载 | USB CDC命令ISP下载 | C | 24MHz | ⭐⭐⭐⭐ |  |
| A03 | 电脑端的ISP软件通过USB-HID发送命令通知MCU软复位到系统区不停电下载 | USB HID命令ISP下载 | C | 24MHz | ⭐⭐⭐⭐ |  |
| A04 | 电脑端的ISP软件通过UART发送命令通知MCU软复位到系统区不停电下载 | UART命令ISP下载 | C | 24MHz | ⭐⭐⭐ |  |

---

## 详细功能说明

### 基础入门系列 (01-09)

#### 01 - P0口跑马灯
**核心功能**：
- P0口8个LED依次点亮，形成跑马灯效果
- 每个LED点亮250ms
- 低电平驱动LED

**技术要点**：
- GPIO配置为推挽输出模式
- 软件延时实现
- IO口基本操作

**应用场景**：
- 入门第一课
- GPIO基础学习
- LED控制基础

**文件结构**：
```
01-用P0口做跑马灯/
├── C语言/
│   ├── main.c          # C语言实现
│   ├── sample.hex      # 编译后的HEX文件
│   └── sample.uvproj   # Keil工程文件
└── 汇编/
    ├── LED.asm         # 汇编实现
    └── LED.uvproj      # 汇编工程文件
```

---

#### 02 - Timer0-Timer1-Timer2-Timer3-Timer4测试程序
**核心功能**：
- 同时使用5个定时器
- 每个定时器产生不同频率的中断
- 中断中翻转IO口输出方波

**定时器配置**：
| 定时器 | 中断频率 | 输出引脚 | 输出频率 |
|--------|----------|----------|----------|
| Timer0 | 1000Hz   | P0.7     | 500Hz    |
| Timer1 | 2000Hz   | P0.6     | 1000Hz   |
| Timer2 | 3000Hz   | P0.5     | 1500Hz   |
| Timer3 | 4000Hz   | P0.4     | 2000Hz   |
| Timer4 | 5000Hz   | P0.3     | 2500Hz   |

**技术要点**：
- 16位自动重装模式
- 中断服务函数编写
- 定时器初值计算：T = 65536 - (Fosc / 12 / 中断频率)
- 多中断管理

**应用场景**：
- 多任务时间基准
- 频率信号发生器
- PWM软件实现

---

#### 06 - 主时钟停振低功耗模式-专用唤醒定时器唤醒
**核心功能**：
- MCU进入停振低功耗模式
- 专用唤醒定时器定时唤醒
- 功耗极低，适合电池供电

**低功耗参数**：
- 停振模式功耗：<1μA
- 唤醒时间：ms级
- 唤醒源：专用定时器

**技术要点**：
- PCON寄存器配置
- 唤醒定时器设置
- 唤醒后状态恢复

**应用场景**：
- 电池供电设备
- 间歇工作系统
- 传感器定时采集

---

### 通信系列 (10-14)

#### 10 - 串口1中断模式与电脑收发测试
**核心功能**：
- UART1全双工通信
- 中断方式收发
- 回显测试（接收数据原样返回）

**串口配置**：
- 波特率：115200 bps
- 数据位：8
- 校验位：无
- 停止位：1
- 引脚：P3.0(TXD), P3.1(RXD)

**技术要点**：
- 串口初始化配置
- 波特率发生器设置（Timer1或Timer2）
- 接收中断处理
- 发送函数实现
- 缓冲区管理

**代码示例**：
```c
void UART1_Init() {
    S1_8bit();              // 8位数据位
    S1_USE_P30P31();        // 使用P3.0/P3.1
    AUXR |= 0x01;           // S1 BRT使用Timer2
    T2L = (65536 - (MAIN_Fosc/4/115200));  // 波特率115200
    T2H = (65536 - (MAIN_Fosc/4/115200))>>8;
    AUXR |= 0x10;           // 启动Timer2
    ES = 1;                 // 使能串口中断
    EA = 1;                 // 总中断使能
}
```

**应用场景**：
- PC通信
- 模块间通信
- 调试输出

---

#### 14.1 - 串口1串口2中断模式同时与电脑收发测试
**核心功能**：
- UART1和UART2同时工作
- 各自独立收发数据
- 中断方式处理

**双串口配置**：
| 串口   | 引脚          | 波特率  | 用途       |
|--------|---------------|---------|------------|
| UART1  | P3.0, P3.1    | 115200  | 主通信口   |
| UART2  | P4.2, P4.3    | 115200  | 辅助通信口 |

**技术要点**：
- 双串口初始化
- 不同波特率发生器
- 中断优先级设置
- 数据缓冲区隔离

**应用场景**：
- 双通道通信
- GPS+GSM模块
- 多设备联网

---

### 人机交互系列 (15-18)

#### 15 - IO行列扫描按键，数码管显示键值，按键调整数码管显示内容
**核心功能**：
- 4x4矩阵键盘扫描（键码25-32）
- 8位数码管显示
- 左4位显示时间（时:分）
- 右2位显示按键值
- 按键调整时间

**按键功能**：
| 键码 | 功能   |
|------|--------|
| 25   | 小时+  |
| 26   | 小时-  |
| 27   | 分钟+  |
| 28   | 分钟-  |

**技术要点**：
- 行列扫描算法
- 按键去抖动（软件延时）
- 长按检测（>1秒）
- 重键输出（10键/秒）
- 74HC595级联驱动数码管
- 动态扫描显示

**扫描流程**：
```
1. 设置行线为输出，列线为输入（上拉）
2. 逐行输出低电平
3. 读取列线状态
4. 有按键按下则列线为低
5. 计算键码 = 行号*8 + 列号 + 基准值
6. 去抖动确认
```

**应用场景**：
- 时钟产品
- 参数设置界面
- 密码输入

---

#### 16 - ADC检测16个按键，数码管显示键值，按键调整数码管显示内容
**核心功能**：
- 16个按键通过电阻分压
- ADC采样识别按键
- 功能与示例15相同

**ADC按键原理**：
```
VCC---R1---+---R2---+---R3---+...+---R16---GND
           |       |       |       |
          KEY1    KEY2    KEY3   KEY16
           |       |       |       |
           +-------+-------+-------+---> ADC输入
```

**识别算法**：
```c
u16 adc_value = Get_ADC();
if (adc_value >= 50 && adc_value < 150) {
    KeyCode = 1;
} else if (adc_value >= 150 && adc_value < 250) {
    KeyCode = 2;
}
// ... 其他按键范围判断
```

**技术要点**：
- ADC初始化和采样
- 电压范围分段
- 多次采样平均
- 需要4V以上供电保证精度

**优缺点**：
- 优点：节省IO口，可扩展按键多
- 缺点：不支持多键同时按下

**应用场景**：
- IO口资源紧张时
- 遥控器
- 简易键盘

---

### 模拟量与传感器系列 (17-18, 39)

#### 17 - ADC采集NTC热敏电阻测温度，数码管显示
**核心功能**：
- NTC热敏电阻测温
- 温度范围：-40°C ~ +125°C
- 分辨率：0.1°C
- 数码管显示温度值

**NTC测温原理**：
```
VCC
 |
 R1 (已知阻值)
 |
 +---> ADC输入
 |
NTC (阻值随温度变化)
 |
GND
```

**温度转换**：
1. ADC采样得到电压值
2. 计算NTC电阻：`R_ntc = R1 * (Vcc/Vadc - 1)`
3. 查表或公式计算温度

**B值公式**：
```
T = 1 / (1/T0 + (1/B) * ln(R/R0))
其中：
T0 = 25°C (298.15K)
R0 = 25°C时的阻值
B = NTC的B值（3950左右）
```

**技术要点**：
- ADC多次采样平均
- 温度查表法（节省运算）
- 公式法（精度高）
- 负温度显示处理

**应用场景**：
- 温度监测
- 温控系统
- 环境监测

---

#### 18 - P1.3做ADC3-使用ADC15测量内部1.19V信号源，计算外部电压VCC
**核心功能**：
- 测量系统VCC电压
- 使用内部1.19V基准
- P1.3外部电压测量

**VCC测量原理**：
```
ADC15采样内部1.19V基准，ADC参考源是VCC
ADC_value = 1.19V / VCC * 4096
因此：VCC = 1.19V * 4096 / ADC_value
```

**外部电压测量**：
```
通过分压电路将待测电压降到ADC范围内
Vin = ADC_value * VCC / 4096 * 分压比
```

**技术要点**：
- 内部1.19V基准使能
- ADC15通道选择
- 电压计算公式
- 显示小数位处理

**应用场景**：
- 电池电压监测
- 电源管理
- 电压测量仪表

---

#### 39 - 一线制温度传感器 DS18B20 测温-IO模拟
**核心功能**：
- DS18B20数字温度传感器
- 单总线协议（1-Wire）
- 数码管+串口显示温度

**DS18B20特性**：
- 测温范围：-55°C ~ +125°C
- 精度：±0.5°C
- 分辨率：可配置9~12位（0.5°C ~ 0.0625°C）
- 单总线通信
- 内置唯一序列号

**1-Wire协议时序**：
```
1. 初始化：主机拉低480~960μs，释放，等待60~240μs应答
2. 写0：拉低60~120μs，释放
3. 写1：拉低1~15μs，释放
4. 读位：拉低1~15μs，释放，15μs内读取总线电平
```

**操作流程**：
```c
1. 初始化DS18B20
2. 发送0xCC（跳过ROM）
3. 发送0x44（启动温度转换）
4. 等待转换完成（750ms）
5. 初始化DS18B20
6. 发送0xCC（跳过ROM）
7. 发送0xBE（读取温度）
8. 读取9字节数据
9. 提取温度值（前2字节）
10. 计算实际温度
```

**温度计算**：
```c
// 12位分辨率
int16_t temp_raw = (data[1] << 8) | data[0];
float temperature = temp_raw / 16.0;  // 单位：°C
```

**技术要点**：
- 精确时序控制（μs级）
- CRC校验
- 负温度处理
- 多传感器寻址（ROM命令）

**应用场景**：
- 高精度测温
- 多点温度采集
- 温度报警系统

---

### 存储器系列 (19-22, 28, 35)

#### 19 - 通过串口发送命令读写EEPROM测试程序
**核心功能**：
- 串口命令控制内部EEPROM
- 支持写入和读出操作
- 掉电数据不丢失

**命令格式**：
```
W 0x000040 1234567890    # 写入
R 0x000040 10            # 读出10字节
```

**EEPROM操作流程**：

**擦除**：
```c
void EEPROM_SectorErase(u32 addr) {
    IAP_CONTR = 0x80;          // 使能IAP
    IAP_TPS = MAIN_Fosc/1000000; // 设置等待时间
    IAP_CMD = 0x03;            // 扇区擦除命令
    IAP_ADDRL = addr;
    IAP_ADDRM = addr >> 8;
    IAP_ADDRH = addr >> 16;
    IAP_TRIG = 0x5A;           // 触发命令
    IAP_TRIG = 0xA5;
    _nop_();                   // 等待完成
}
```

**写入**：
```c
void EEPROM_WriteByte(u32 addr, u8 dat) {
    IAP_CONTR = 0x80;
    IAP_TPS = MAIN_Fosc/1000000;
    IAP_CMD = 0x02;            // 字节写入命令
    IAP_ADDRL = addr;
    IAP_ADDRM = addr >> 8;
    IAP_ADDRH = addr >> 16;
    IAP_DATA = dat;
    IAP_TRIG = 0x5A;
    IAP_TRIG = 0xA5;
    _nop_();
}
```

**读取**：
```c
u8 EEPROM_ReadByte(u32 addr) {
    IAP_CONTR = 0x80;
    IAP_TPS = MAIN_Fosc/1000000;
    IAP_CMD = 0x01;            // 字节读取命令
    IAP_ADDRL = addr;
    IAP_ADDRM = addr >> 8;
    IAP_ADDRH = addr >> 16;
    IAP_TRIG = 0x5A;
    IAP_TRIG = 0xA5;
    _nop_();
    return IAP_DATA;
}
```

**技术要点**：
- 扇区擦除（512字节为单位）
- 写入前必须先擦除
- IAP等待时间计算
- 地址范围检查

**注意事项**：
- 下载时设置EEPROM大小（包括用户系统区）
- 例如：用户系统区4K + EEPROM区8K = 设置12K
- 确保命令地址在设置范围内

**应用场景**：
- 参数保存
- 配置存储
- 历史数据记录

---

#### 22 - 使用比较器检测外部稳压管输入前端，掉电时及时保存数据到EEPROM
**核心功能**：
- 比较器监测电源输入
- 掉电预警
- 及时保存重要数据

**掉电保护原理**：
```
外部电源 --> 稳压器(7805) --> VCC
    |
    +----> 比较器正极输入
    
比较器负极 = 设定阈值(如4.5V)

当外部电源下降时：
1. 比较器先检测到（稳压器输入端）
2. 触发中断
3. 此时VCC还稳定（电容维持）
4. 有足够时间保存数据到EEPROM
```

**vs LVD方案**：
| 特性 | LVD方案 | 比较器方案 |
|------|---------|-----------|
| 检测点 | VCC直接 | 稳压器输入端 |
| 反应时间 | 很短 | 较长 |
| 可靠性 | 低 | 高（推荐） |
| 保存时间 | 不够 | 充足 |

**比较器配置**：
```c
void Comparator_Init() {
    CMPCR1 = 0x80;          // 使能比较器
    CMPCR1 |= 0x20;         // 正极输入选择外部引脚
    CMPCR1 |= 0x10;         // 负极输入选择内部DAC
    CMPEXCFG = 0x01;        // 使能比较器中断
    CMPO = 1;               // 比较器中断优先级
    EA = 1;
}
```

**中断处理**：
```c
void Comparator_ISR() interrupt 21 {
    CMPIF = 0;              // 清除中断标志
    
    // 保存重要数据
    Save_Critical_Data_To_EEPROM();
    
    // 设置掉电标志
    PowerFail_Flag = 1;
}
```

**技术要点**：
- 比较器阈值设置
- 中断响应速度
- 数据保存优先级
- 恢复后数据校验

**应用场景**：
- 仪表仪器
- 工业控制
- 数据记录设备

---

### PWM与控制系列 (23-26, 68, 83)

#### 24 - 高级PWM1-PWM2-PWM3-PWM4，驱动P0口呼吸灯实验程序
**核心功能**：
- 8通道高级PWM
- P0口8个LED呼吸灯效果
- 支持互补对称输出

**通道配置**：
| 通道       | 正极输出 | 负极输出 | 模式           |
|-----------|---------|---------|---------------|
| PWM1P/N   | P0.0    | P0.1    | 独立或互补     |
| PWM2P/N   | P0.2    | P0.3    | 独立或互补     |
| PWM3P/N   | P0.4    | P0.5    | 独立或互补     |
| PWM4P/N   | P0.6    | P0.7    | 独立或互补     |

**PWM参数**：
- 周期：可设置1~65535
- 占空比：可设置0~周期值
- 频率：Fpwm = Fsys / (周期 × 预分频)

**呼吸灯实现**：
```c
u16 pwm_duty = 0;
u8 direction = 1;  // 1=增加，0=减少

void PWM_Breath() {
    if (direction) {
        pwm_duty += 10;
        if (pwm_duty >= PWM_PERIOD) {
            direction = 0;
        }
    } else {
        pwm_duty -= 10;
        if (pwm_duty == 0) {
            direction = 1;
        }
    }
    
    PWM1_SetDuty(pwm_duty);
}
```

**互补输出**：
```
PWM1P: ‾‾‾‾‾‾‾‾|________|‾‾‾‾‾‾‾‾
PWM1N: ________|‾‾‾‾‾‾‾‾|________
       <-死区-> <-高电平-> <-死区->
```

**死区控制**：
- 防止上下桥臂直通
- 可设置死区时间
- 用于电机驱动H桥

**技术要点**：
- PWM初始化配置
- 占空比动态调节
- 死区时间设置
- 输出引脚配置

**应用场景**：
- LED调光
- 电机调速
- 开关电源控制
- 舵机控制

---

#### 83 - 高级PWM硬件移相
**核心功能**：
- PWM通道间硬件移相
- 相位可调
- 用于多相控制

**移相原理**：
```
PWM1: ‾‾‾‾|____|‾‾‾‾|____|
PWM2: __|‾‾‾‾|____|‾‾‾‾|__|
      <-相位差->
```

**移相配置**：
```c
// 设置PWM2相对PWM1的相位差
PWM2_PhaseShift = PWM_PERIOD / 4;  // 90度相位差
```

**技术要点**：
- 相位寄存器设置
- 多通道同步
- 相位角计算

**应用场景**：
- 三相电机控制
- 多相开关电源
- 步进电机驱动
- 同步整流

---

### 综合应用示例

#### 27 - 通过定时器周期性调度任务综合例程（强烈推荐）⭐⭐⭐⭐⭐
**核心功能**：
这是一个完整的多任务调度系统框架，展示了如何组织复杂项目。

**系统架构**：
```
Timer0 (1ms节拍)
    ↓
任务调度器
    ├─ 时钟任务 (1000ms周期)
    ├─ 温度采集任务 (500ms周期)
    ├─ 键盘扫描任务 (20ms周期)
    ├─ 显示刷新任务 (2ms周期)
    └─ 蜂鸣器任务 (按需触发)
```

**文件结构**：
```
27-任务调度系统/
├── app.h              # 应用层头文件
├── Config.h           # 配置文件
├── Type_def.h         # 类型定义
├── Sources/
│   ├── inc/           # 头文件目录
│   │   ├── AI8051U.H
│   │   ├── Task.h     # 任务调度器
│   │   ├── adc.h
│   │   ├── app_rtc.h  # 时钟应用
│   │   ├── app_ntc.h  # 温度应用
│   │   ├── app_Display.h
│   │   ├── app_MatrixKey.h
│   │   └── app_adcKey.h
│   ├── isr/
│   │   └── Timer_Isr.c  # 定时器中断
│   └── src/
│       ├── main.c
│       ├── Task.c       # 任务调度实现
│       ├── app_rtc.c
│       ├── app_ntc.c
│       └── ...
```

**任务调度器实现**：
```c
typedef struct {
    u16 period;      // 任务周期(ms)
    u16 counter;     // 计数器
    void (*func)();  // 任务函数指针
} Task_t;

Task_t TaskList[] = {
    {1000, 0, Task_Clock},      // 1秒执行一次
    {500,  0, Task_Temperature},// 500ms执行一次
    {20,   0, Task_KeyScan},    // 20ms执行一次
    {2,    0, Task_Display},    // 2ms执行一次
};

void Task_Scheduler() {  // 在1ms定时器中断中调用
    for (u8 i=0; i<sizeof(TaskList)/sizeof(Task_t); i++) {
        if (++TaskList[i].counter >= TaskList[i].period) {
            TaskList[i].counter = 0;
            TaskList[i].func();  // 执行任务
        }
    }
}
```

**功能实现**：

1. **时钟功能**：
   - 时:分:秒计时
   - 左4位数码管显示时:分
   - 按键调整时间

2. **温度显示**：
   - NTC热敏电阻测温
   - 右4位数码管显示xx.x°C
   - 0.1度分辨率

3. **按键处理**：
   - 矩阵键盘扫描（机械按键）
   - ADC按键扫描（0-3号键）
   - 按键功能：
     - ADC键0：小时+
     - ADC键1：小时-
     - ADC键2：分钟+
     - ADC键3：分钟-
   - 按键蜂鸣器反馈

4. **显示刷新**：
   - 8位数码管动态扫描
   - 74HC595驱动
   - 2ms刷新一次，无闪烁

**技术亮点**：
1. **模块化设计**：每个功能独立模块
2. **时间片调度**：合理分配CPU时间
3. **可扩展性强**：易于添加新任务
4. **实用性高**：可直接用于产品开发

**学习价值**：
- 理解多任务概念
- 学习项目组织结构
- 掌握定时器应用
- 了解实际产品架构

**应用场景**：
- 智能时钟
- 环境监测仪
- 多功能仪表
- 各类嵌入式产品

**为什么强烈推荐**：
这个示例展示了专业的嵌入式软件架构，比简单的while(1)轮询高级得多，是从玩具程序到产品代码的分水岭。

---

## 附录：常用技术参数表

### 时钟频率选择指南
| 频率 | 适用场景 | 说明 |
|------|---------|------|
| 24MHz | 通用应用 | 最常用，兼容性好 |
| 22.1184MHz | 串口通信 | 精确波特率，误差小 |
| 25.6MHz | WS2812驱动 | SPI分频3.2MHz最佳 |
| 36.864MHz | USB音频 | 48kHz采样率倍数 |
| 32768Hz | RTC时钟 | 外部晶振，实时时钟 |

### 串口波特率表（22.1184MHz）
| 波特率 | Timer1(12T) | Timer2(1T) | 误差 |
|--------|-------------|-----------|------|
| 1200   | ✓          | ✓         | 0%   |
| 2400   | ✓          | ✓         | 0%   |
| 4800   | ✓          | ✓         | 0%   |
| 9600   | ✓          | ✓         | 0%   |
| 19200  | ✓          | ✓         | 0%   |
| 38400  | ✓          | ✓         | 0%   |
| 57600  | ✓          | ✓         | 0%   |
| 115200 | ✗          | ✓         | 0%   |

### ADC参数
- 分辨率：12位（0-4095）
- 参考电压：VCC或内部1.19V
- 转换时间：约10μs @ 24MHz
- 通道数：16路（15路外部+1路内部）
- 输入范围：0 ~ VCC

### PWM参数
| 类型 | 通道数 | 周期范围 | 分辨率 | 频率范围 |
|------|--------|---------|--------|----------|
| PCA-PWM | 4 | 8位 | 256级 | ~94kHz |
| 高级PWM | 8 | 16位 | 65536级 | ~366Hz |
| HS-PWM | 4 | 16位 | 65536级 | 更高 |

### DMA性能
- 传输速度：最高达系统时钟速度
- 通道数：8个独立通道
- 传输模式：M2M, P2M, M2P, P2P
- 块大小：最大65535字节
- CPU占用：0%（传输期间）

---

**📚 完整示例清单已列出，建议配合功能分类索引和主README一起使用！**

